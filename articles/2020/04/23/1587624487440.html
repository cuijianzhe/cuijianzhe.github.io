<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>Kubernetes服务访问 - 邯城往事</title><meta name="description" content="  感情淡了我们再培养，无话可说了我们就再去找话题，觉得腻了我们就重新认识，要是累了就给彼此空间，人潮汹涌的遇到你也不容易，也不想再推开了。"/><meta property="og:description" content="  感情淡了我们再培养，无话可说了我们就再去找话题，觉得腻了我们就重新认识，要是累了就给彼此空间，人潮汹涌的遇到你也不容易，也不想再推开了。"/>    <meta name="keywords" content="包容、开放、任性、桀骜"/><link rel="dns-prefetch" href="https://cdn.jsdelivr.net/gh/88250/solo@dee9f7f/src/main/resources"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://cdn.jsdelivr.net/gh/88250/solo@dee9f7f/src/main/resources"><link rel="icon" type="image/png" href="https://img.hacpai.com/file/2019/11/guohui-e67e7b3b.png"/><link rel="apple-touch-icon" href="https://img.hacpai.com/file/2019/11/guohui-e67e7b3b.png"><link rel="shortcut icon" type="image/x-icon" href="https://img.hacpai.com/file/2019/11/guohui-e67e7b3b.png"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="Kubernetes服务访问 - 邯城往事"/><meta property="og:site_name" content="邯城往事"/><meta property="og:url"      content="https://cuijianzhe.github.io/articles/2020/04/23/1587624487440.html?"/><meta property="og:image" content="https://img.hacpai.com/file/2019/11/guohui-e67e7b3b.png"/><link rel="search" type="application/opensearchdescription+xml" title="Kubernetes服务访问 - 邯城往事" href="/opensearch.xml"><link href="https://cuijianzhe.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://cuijianzhe.github.io/manifest.json">        <link rel="canonical" href="https://cuijianzhe.github.io/articles/2020/04/23/1587624487440.html">        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/gh/88250/solo@dee9f7f/src/main/resources/skins/Pinghsu/css/base.css?1597690831817"/>
            <link rel="prev" title="KUbernets实践之pod控制器" href="https://cuijianzhe.github.io/articles/2020/04/22/1587528230774.html">
            <link rel="next" title="Gitlab迁移" href="https://cuijianzhe.github.io/articles/2020/04/25/1587784213122.html">
    <!--鼠标点击特效-->
<script src="https://cdn.jsdelivr.net/gh/fz6m/Private-web@1.2/js/custom/click.min.js"></script>
<!--页面动态樱花-->
<!--script type="text/javascript"src="https://cdn.jsdelivr.net/gh/fz6m/Private-web@1.2/js/sakura/sakura-original.js"--></script>
</head>
<body>
<header class="header">
    <div class="wrapper">
        <a href="https://cuijianzhe.github.io" rel="start" class="header__logo">
            <img src="https://img.hacpai.com/avatar/1551626533851_1579241477243.png?imageView2/1/w/128/h/128/interlace/0/q/100" alt="邯城往事"/>
            邯城往事
        </a>

        <nav class="header__nav mobile__none">
            <a href="https://cuijianzhe.github.io/tags.html" rel="section">
                Tags
            </a>
            <a href="https://cuijianzhe.github.io/archives.html">
                Archives
            </a>
            <a rel="archive" href="https://cuijianzhe.github.io/links.html">
                Links
            </a>
        </nav>

        <div class="header__bar fn__none" onclick="$(this).next().slideToggle()">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                <path fill="#444" d="M0 3h20v2h-20v-2zM0 9h20v2h-20v-2zM0 15h20v2h-20v-2z"></path>
            </svg>
        </div>
        <main class="header__menu fn__none">
            <ul>
                    <li>
                        <a href="/my-github-repos" target="_self" rel="section">
                            我的开源
                        </a>
                    </li>
                    <li>
                        <a href="http://fuck.cjzshilong.cn/time/time.html" target="_blank" rel="section">
                            服务器倒计时
                        </a>
                    </li>
                <li>
                    <a href="https://cuijianzhe.github.io/tags.html" rel="section">
                        Tags
                    </a>
                </li>
                <li>
                    <a href="https://cuijianzhe.github.io/archives.html">
                        Archives
                    </a>
                </li>
                <li>
                    <a rel="archive" href="https://cuijianzhe.github.io/links.html">
                        Links
                    </a>
                </li>
                <li>
                    <a rel="alternate" href="https://cuijianzhe.github.io/rss.xml" rel="section">
                        RSS
                    </a>
                </li>
            </ul>
        </main>
    </div>
</header>
<main id="pjax" class="fn__flex-1">
    
    <div class="post wrapper wrapper--miner">
        <h2 class="item__title">
            <a rel="bookmark" href="https://cuijianzhe.github.io/articles/2020/04/23/1587624487440.html">
                Kubernetes服务访问
            </a>
        </h2>
        <div class="ft__fade item__meta">
                Updated on
            <time>
                Aug 15, 2020
            </time>
                in <a href="https://cuijianzhe.github.io/category/linux">Linux系列</a>
            with <span data-uvstaturl="https://cuijianzhe.github.io/articles/2020/04/23/1587624487440.html">0</span> views
                and <a href="#b3logsolocomments"><span data-uvstatcmt="1587624487440">0</span> comments</a>
        </div>
        <div class="item__tags">
                <a rel="tag" class="tag tag--0" href="https://cuijianzhe.github.io/tags/kubernetes">
                    <b># kubernetes</b>
                </a>
                <a rel="tag" class="tag tag--1" href="https://cuijianzhe.github.io/tags/Linux">
                    <b># Linux</b>
                </a>
        </div>
        <div class="vditor-reset">
            <p>  通过 Deployment 来创建一组 Pod 来提供具有高可用性的服务。虽然每个 Pod 都会分配一个单独的 Pod IP，然而却存在如下两个问题：</p>
<ul>
<li>Pod IP 仅仅是集群内可见的虚拟 IP，外部无法访问。</li>
<li>Pod IP 会随着 Pod 的销毁而消失，当 ReplicaSet 对 Pod 进行动态伸缩时，Pod IP 可能随时随地都会变化，这样对于我们访问这个服务带来了难度。</li>
</ul>
<h1 id="Service-负载均衡之Cluster-IP">Service 负载均衡之 Cluster IP</h1>
<p>  service 是一组 pod 的服务抽象，相当于一组 pod 的 LB，负责将请求分发给对应的 pod。service 会为这个 LB 提供一个 IP，一般称为 cluster IP 。使用 Service 对象，通过 selector 进行标签选择，找到对应的 Pod:</p>
<ul>
<li>示例：</li>
</ul>
<pre><code class="language-bash highlight-chroma"><span class="highlight-o">[</span>root@k8s-master deployment<span class="highlight-o">]</span><span class="highlight-c1"># cat svc-myblog.yaml </span>
apiVersion: v1
kind: Service
metadata:
  name: myblog
  namespace: demo
spec:
  ports:
  - port: <span class="highlight-m">80</span>
    protocol: TCP
    targetPort: <span class="highlight-m">8002</span>
  selector:
    app: myblog
  type: ClusterIP
</code></pre>
<ul>
<li>操作示例：</li>
</ul>
<p>  <strong>别名</strong><br>
<code>[root@k8s-master deployment]# alias kd='kubectl -n demo'</code><br>
<strong>创建服务</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl create -f svc-myblog.yaml 
service/myblog created
[root@k8s-master deployment]# kubectl -n demo  get po --show-labels
NAME                     READY   STATUS    RESTARTS   AGE   LABELS
myblog-b66554b87-jg9k8   1/1     Running   0          12m   app=myblog,pod-template-hash=b66554b87
myblog-b66554b87-phv4x   1/1     Running   0          16m   app=myblog,pod-template-hash=b66554b87
mysql-8fcc5595f-trnx9    1/1     Running   0          28h   app=mysql,pod-template-hash=8fcc5595f
[root@k8s-master deployment]# kubectl -n demo get svc 
NAME     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
myblog   ClusterIP   10.105.22.70    &lt;none&gt;        80/TCP     32s
mysql    ClusterIP   10.100.42.154   &lt;none&gt;        3306/TCP   37s
[root@k8s-master deployment]# kubectl -n demo describe svc myblog 
Name:              myblog
Namespace:         demo
Labels:            &lt;none&gt;
Annotations:       &lt;none&gt;
Selector:          app=myblog
Type:              ClusterIP
IP:                10.105.22.70
Port:              &lt;unset&gt;  80/TCP
TargetPort:        8002/TCP
Endpoints:         10.244.1.25:8002,10.244.2.13:8002
Session Affinity:  None
Events:            &lt;none&gt;
</code></pre>
<p>  <strong>Service 与 Pod 如何关联：</strong></p>
<p>  service 对象创建的同时，会创建同名的 endpoints 对象，若服务设置了 readinessProbe, 当 readinessProbe 检测失败时，endpoints 列表中会剔除掉对应的 pod_ip，这样流量就不会分发到健康检测失败的 Pod 中</p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n demo  get endpoints myblog 
NAME     ENDPOINTS                           AGE
myblog   10.244.1.25:8002,10.244.2.13:8002   8m36s
</code></pre>
<p>  <strong>Service Cluster-IP 如何访问：</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n demo get svc myblog 
NAME     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
myblog   ClusterIP   10.105.22.70   &lt;none&gt;        80/TCP    9m22s
</code></pre>
<p>  <code>[root@k8s-master deployment]# curl 10.105.22.70/blog/index</code></p>
<p>  <strong>为 MySQL 创建 svc：</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# cat svc-mysql.yaml 
apiVersion: v1
kind: Service
metadata:
  name: mysql
  namespace: demo
spec:
  ports:
  - port: 3306
    protocol: TCP
    targetPort: 3306
  selector:
    app: mysql
  type: ClusterIP
</code></pre>
<p>  <strong>访问 MySQL：</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n demo get svc mysql 
NAME    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
mysql   ClusterIP   10.100.42.154   &lt;none&gt;        3306/TCP   11m
</code></pre>
<p>  <code>curl 10.100.42.154:3306</code></p>
<p>  <strong>目前使用 hostNetwork 部署，通过宿主机 ip+port 访问，弊端：</strong></p>
<ul>
<li>服务使用 hostNetwork，使得宿主机的端口大量暴漏，存在安全隐患</li>
<li>容易引发端口冲突</li>
</ul>
<p>  服务均属于 k8s 集群，尽可能使用 k8s 的网络访问，因此可以对目前 myblog 访问 MySQL 的方式做改造：</p>
<ul>
<li>为 MySQL 创建一个固定 clusterIp 的 Service，把 clusterIp 配置在 myblog 的环境变量中</li>
<li>利用集群服务发现的能力，组件之间通过 service name 来访问</li>
</ul>
<h3 id="服务发现">服务发现</h3>
<p>  在 k8s 集群中，组件之间可以通过定义的 Service 名称实现通信。</p>
<p>  演示服务发现：<br>
<del>演示思路：在 myblog 的容器中直接通过 service 名称访问服务，观察是否可以访问通</del><br>
先查看服务：</p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n demo get svc 
NAME     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
myblog   ClusterIP   10.105.22.70    &lt;none&gt;        80/TCP     14m
mysql    ClusterIP   10.100.42.154   &lt;none&gt;        3306/TCP   14m
</code></pre>
<p>  进入 myblog 服务：</p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n demo get pods 
NAME                     READY   STATUS    RESTARTS   AGE
myblog-b66554b87-jg9k8   1/1     Running   0          30m
myblog-b66554b87-phv4x   1/1     Running   0          33m
mysql-8fcc5595f-trnx9    1/1     Running   0          28h
[root@k8s-master deployment]# kubectl -n demo exec -it myblog-b66554b87-jg9k8 bash 
[root@myblog-b66554b87-jg9k8 myblog]# curl mysql:3306
5.7.29۾?f(+"ÿÿ!ÿ?9Td	e#|3]Imysql_native_passwordot packets out of order[root@myblog-b66554b87-jg9k8 myblog]# 
[root@myblog-b66554b87-jg9k8 myblog]# curl myblog/blog/index/
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;首页&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h3&gt;我的博客列表：&lt;/h3&gt;
    

    &lt;/br&gt;
    &lt;/br&gt;
    &lt;a href=" /blog/article/edit/0 "&gt;写博客&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>  虽然 podip 和 Clusterip 都不固定，但是 service name 是固定的，而且具有完全的跨集群可移植性，因此组件之间调用的同时，完全可以通过 service name 去通信，这样避免了大量的 ip 维护成本，使得服务的 YAML 模板更加简单。因此可以对 MySQL 和 myblog 的部署进行优化改造：</p>
<ol>
<li>MySQL 可以去掉 hostNetwork 部署，使得服务只暴漏在 k8s 集群内部网络</li>
<li>configMap 中数据库地址可以换成 Service 名称，这样跨环境的时候，配置内容基本上可以保持不用变化</li>
</ol>
<p>  修改 deploy-mysql.yaml:</p>
<pre><code class="highlight-chroma">spec:
      hostNetwork: true	# 去掉此行
      volumes: 
      - name: mysql-data
        hostPath: 
          path: /opt/mysql/data
</code></pre>
<p>  修改 configmap.yaml</p>
<pre><code class="highlight-chroma">apiVersion: v1
kind: ConfigMap
metadata:
  name: myblog
  namespace: demo
data:
  MYSQL_HOST: "mysql"	# 此处替换为mysql
  MYSQL_PORT: "3306"
</code></pre>
<p>  应用修改：</p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl apply -f deploy-mysql.yaml 
Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
deployment.apps/mysql configured
[root@k8s-master deployment]# kubectl apply -f configmap.yaml 
Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
configmap/myblog configured
[root@k8s-master deployment]# kubectl -n demo delete pod mysql-8fcc5595f-trnx9   #重建应用
pod "mysql-8fcc5595f-trnx9" deleted
</code></pre>
<h3 id="服务发现实现-">服务发现实现：</h3>
<p>  <code>CoreDNS</code> 是一个 <code>Go</code> 语言实现的链式插件 <code>DNS服务端</code>，是 CNCF 成员，是一个高性能、易扩展的 <code>DNS服务端</code>。</p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n kube-system get po -o wide|grep dns
coredns-67c766df46-k7ccm             1/1     Running   0          8d    10.244.1.2       k8s-slave1   &lt;none&gt;           &lt;none&gt;
coredns-67c766df46-kr6kh             1/1     Running   0          8d    10.244.1.3       k8s-slave1   &lt;none&gt;           &lt;none&gt;
</code></pre>
<p>  <strong>查看 myblog 的 pod 解析配置</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n demo get pod
NAME                     READY   STATUS    RESTARTS   AGE
myblog-b66554b87-jg9k8   1/1     Running   0          3h22m
myblog-b66554b87-phv4x   1/1     Running   0          3h25m
mysql-8fcc5595f-vvrqs    1/1     Running   0          166m
[root@k8s-master deployment]# kubectl -n demo exec -it myblog-b66554b87-phv4x  bash 
[root@myblog-b66554b87-phv4x myblog]# cat /etc/resolv.conf 
nameserver 10.96.0.10
search demo.svc.cluster.local svc.cluster.local cluster.local
options ndots:5
</code></pre>
<p>  <strong>10.96.0.10 从哪来</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n kube-system get svc 
NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE
kube-dns   ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   9d
</code></pre>
<p>  ** 启动 pod 的时候，会把 kube-dns 服务的 cluster-ip 地址注入到 pod 的 resolve 解析配置中，同时添加对应的 namespace 的 search 域。 因此跨 namespace 通过 service name 访问的话，需要添加对应的 namespace 名称，<br>
service_name.namespace_name**</p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl get svc 
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   9d
</code></pre>
<h2 id="Service负载均衡之NodePort">Service 负载均衡之 NodePort</h2>
<p>  cluster-ip 为虚拟地址，只能在 k8s 集群内部进行访问，集群外部如果访问内部服务，实现方式之一为使用 NodePort 方式。NodePort 会默认在 30000-32767 ，不指定的会随机使用其中一个。</p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# cat svc-myblog-nodeport.yaml 
apiVersion: v1
kind: Service
metadata:
  name: myblog-np
  namespace: demo
spec:
  ports:
  - port: 80
    protocol: TCP
    targetPort: 8002
  selector:
    app: myblog
  type: NodePort
</code></pre>
<p>  <strong>查看并访问服务：</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl create -f svc-myblog-nodeport.yaml 
service/myblog-np created
[root@k8s-master deployment]# kubectl -n demo get svc
NAME        TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
myblog      ClusterIP   10.105.22.70     &lt;none&gt;        80/TCP         3h22m
myblog-np   NodePort    10.111.115.111   &lt;none&gt;        80:30505/TCP   13s
mysql       ClusterIP   10.100.42.154    &lt;none&gt;        3306/TCP       3h22m
</code></pre>
<p>  <strong>集群内每个节点的 NodePort 端口都会进行监听</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# curl 192.168.51.210:30505/blog/index/
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;首页&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h3&gt;我的博客列表：&lt;/h3&gt;
    

    &lt;/br&gt;
    &lt;/br&gt;
    &lt;a href=" /blog/article/edit/0 "&gt;写博客&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;[root@k8s-master deployment]# curl 192.168.51.211:30505/blog/index/
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;首页&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h3&gt;我的博客列表：&lt;/h3&gt;
    

    &lt;/br&gt;
    &lt;/br&gt;
    &lt;a href=" /blog/article/edit/0 "&gt;写博客&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="kube-proxy">kube-proxy</h3>
<p>  运行在每个节点上，监听 API Server 中服务对象的变化，再通过创建流量路由规则来实现网络的转发。<a href="https://kubernetes.io/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies" target="_blank">参照</a></p>
<p>  有三种模式：</p>
<ul>
<li>User space, 让 Kube-Proxy 在用户空间监听一个端口，所有的 Service 都转发到这个端口，然后 Kube-Proxy 在内部应用层对其进行转发 ， 所有报文都走一遍用户态，性能不高，k8s v1.2 版本后废弃。</li>
<li>Iptables， 当前默认模式，完全由 IPtables 来实现， 通过各个 node 节点上的 iptables 规则来实现 service 的负载均衡，但是随着 service 数量的增大，iptables 模式由于线性查找匹配、全量更新等特点，其性能会显著下降。</li>
<li>IPVS， 与 iptables 同样基于 Netfilter，但是采用的 hash 表，因此当 service 数量达到一定规模时，hash 查表的速度优势就会显现出来，从而提高 service 的服务性能。 k8s 1.8 版本开始引入，1.11 版本开始稳定，需要开启宿主机的 ipvs 模块。</li>
</ul>
<p>  <strong>IPtables 模式示意图：</strong><br>
<img src="https://file.cjzshilong.cn/pictures_file/services-iptables-overview.svg" alt="services-iptables-overview.svg"></p>
<h2 id="Kubernetes服务访问之Ingress">Kubernetes 服务访问之 Ingress</h2>
<p>  对于 Kubernetes 的 Service，无论是 Cluster-Ip 和 NodePort 均是四层的负载，集群内的服务如何实现七层的负载均衡，这就需要借助于 Ingress，Ingress 控制器的实现方式有很多，比如 nginx, Contour, Haproxy, trafik, Istio，我们以 nginx 的实现为例做演示。</p>
<p>  Ingress-nginx 是 7 层的负载均衡器 ，负责统一管理外部对 k8s cluster 中 service 的请求。主要包含：</p>
<ul>
<li>ingress-nginx-controller：根据用户编写的ingress 规则（创建的ingress 的 YAML 文件），动态的去更改 nginx 服务的配置文件，并且 reload 重载使其生效（是自动化的，通过 lua 脚本来实现）；</li>
<li>ingress 资源对象：将 Nginx 的配置抽象成一个 Ingress 对象，每添加一个新的 Service 资源对象只需写一个新的 Ingress 规则的 YAML 文件即可（或修改已存在的ingress 规则的 YAML 文件）<br>
示意图：<br>
<img src="https://img.hacpai.com/file/2020/04/ingress-c33da153.webp?imageView2/2/w/1280/format/jpg/interlace/1/q/100" alt="ingress.webp"></li>
</ul>
<h3 id="实现逻辑">实现逻辑</h3>
<ol>
<li>ingress controller 通过和 kubernetes API 交互，动态的去感知集群中ingress 规则变化</li>
<li>然后读取ingress 规则(规则就是写明了哪个域名对应哪个 service)，按照自定义的规则，生成一段 nginx 配置</li>
<li>再写到 nginx-ingress-controller 的 pod 里，这个 Ingress controller 的 pod 里运行着一个 Nginx 服务，控制器把生成的 nginx 配置写入/etc/nginx.conf 文件中</li>
<li>然后 reload 一下使配置生效。以此达到域名分别配置和动态更新的问题。</li>
</ol>
<h3 id="安装">安装</h3>
<h4 id="更新myblog的yaml文件容忍度">更新 myblog 的 YAML 文件容忍度</h4>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# cat deploy-myblog-taint.yaml 
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myblog
  namespace: demo
spec:
  replicas: 1	#指定Pod副本数
  selector:		#指定Pod的选择器
    matchLabels:
      app: myblog
  template:
    metadata:
      labels:	#给Pod打label
        app: myblog
    spec:
      tolerations: #设置容忍性
      - key: "smoke" 
        operator: "Equal"  #如果操作符为Exists，那么value属性可省略,不指定operator，默认为Equal
        value: "true"
        effect: "NoSchedule"
      - key: "drunk" 
        operator: "Equal"  #如果操作符为Exists，那么value属性可省略,不指定operator，默认为Equal
        value: "true"
        effect: "NoSchedule"
      containers:
      - name: myblog
        image: 192.168.51.209:5000/myblog
        imagePullPolicy: IfNotPresent
        env:
        - name: MYSQL_HOST
          valueFrom:
            configMapKeyRef:
              name: myblog
              key: MYSQL_HOST
        - name: MYSQL_PORT
          valueFrom:
            configMapKeyRef:
              name: myblog
              key: MYSQL_PORT
        - name: MYSQL_USER
          valueFrom:
            secretKeyRef:
              name: myblog
              key: MYSQL_USER
        - name: MYSQL_PASSWD
          valueFrom:
            secretKeyRef:
              name: myblog
              key: MYSQL_PASSWD
        ports:
        - containerPort: 8002
        resources:
          requests:
            memory: 100Mi
            cpu: 50m
          limits:
            memory: 500Mi
            cpu: 100m
        livenessProbe:
          httpGet:
            path: /blog/index/
            port: 8002
            scheme: HTTP
          initialDelaySeconds: 10  # 容器启动后第一次执行探测是需要等待多少秒
          periodSeconds: 15 	# 执行探测的频率
          timeoutSeconds: 2		# 探测超时时间
        readinessProbe: 
          httpGet: 
            path: /blog/index/
            port: 8002
            scheme: HTTP
          initialDelaySeconds: 10 
          timeoutSeconds: 2
          periodSeconds: 15
</code></pre>
<p>  <strong>执行变更配置 <code>kubectl apply -f deploy-myblog-taint.yaml</code></strong><br>
<strong>点击查看<a href="https://github.com/kubernetes/ingress-nginx/blob/master/docs/deploy/index.md" target="_blank">官方文档</a></strong></p>
<pre><code class="highlight-chroma">[root@k8s-master ingress]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml
[root@k8s-master ingress]# ll
total 8
-rw-r--r--. 1 root root 6731 Apr 24 08:09 mandatory.yaml
</code></pre>
<p>  <strong>修改部署节点：</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master ingress]#  grep -n5 nodeSelector mandatory.yaml
212-    spec:
213-      hostNetwork: true #添加为host模式
214-      # wait up to five minutes for the drain of connections
215-      terminationGracePeriodSeconds: 300
216-      serviceAccountName: nginx-ingress-serviceaccount
217:      nodeSelector:
218-        ingress: "true"   #替换此处，来决定将ingress部署在哪些机器
219-      containers:
220-        - name: nginx-ingress-controller
221-          image: quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0
222-          args:
</code></pre>
<p>  <strong>使用示例：</strong></p>
<h4 id="打标签">打标签</h4>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# cat ingress.yaml 
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: myblog
  namespace: demo
spec:
  rules:
  - host: myblog.devops.cn
    http:
      paths:
      - path: /
        backend:
          serviceName: myblog
          servicePort: 80
</code></pre>
<pre><code class="highlight-chroma">kubectl  label node k8s-slave1 ingress=true
kubectl get nodes --show-labels
kubectl create -f mandatory.yaml
kubectl create -f ingress.yaml
</code></pre>
<p>  <strong>查看ingress-nginx 运行情况</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master ~]# kubectl -n ingress-nginx get pod -o wide 
NAME                                       READY   STATUS    RESTARTS   AGE   IP               NODE         NOMINATED NODE   READINESS GATES
nginx-ingress-controller-766b7d9f4-4pvmj   1/1     Running   0          16h   192.168.51.210   k8s-slave1   &lt;none&gt;           &lt;none&gt;
</code></pre>
<p>  <strong>ingress-nginx 需要用到的镜像：</strong><br>
<code>docker pull bitnami/nginx-ingress-controller:0.30.0</code></p>
<h3 id="访问">访问</h3>
<p>  域名解析服务，将 <code>myblog.devops.cn</code> 解析到ingress 的地址上。ingress 是支持多副本的，高可用的情况下，生产的配置是使用 lb 服务（内网 F5 设备，公网 elb、slb、clb，解析到各ingress 的机器，如何域名指向 lb 地址）<br>
本机，添加如下 hosts 记录来演示效果。<br>
<strong><code>192.168.51.210 myblog.devops.cn</code></strong></p>
<p>  访问：<a href="http://myblog.devops.cn/blog/index/" target="_blank">http://myblog.devops.cn/blog/index/</a></p>
<p>  <img src="https://img.hacpai.com/file/2020/04/image-9fd61ad2.png?imageView2/2/w/1280/format/jpg/interlace/1/q/100" alt="image.png"></p>
<h3 id="自签名证书">自签名证书</h3>
<pre><code class="highlight-chroma">[root@k8s-master ~]# openssl req -x509 -nodes -days 2920 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/CN=*.devops.cn/O=ingress-nginx"
Generating a 2048 bit RSA private key
..............................+++
..........+++
writing new private key to 'tls.key'
-----
</code></pre>
<p>  <strong>证书信息保存到 secret 对象中，ingress-nginx 会读取 secret 对象解析出证书加载到 nginx 配置中</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master ~]# kubectl -n demo create secret tls https-secret --key tls.key --cert tls.crt
secret/https-secret created
</code></pre>
<p>  <strong>修改ingress 的 YAML 文件</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# cat ingress-tls.yaml 
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: myblog-tls
  namespace: demo
spec:
  rules:
  - host: myblog.devops.cn
    http:
      paths:
      - path: /
        backend:
          serviceName: myblog
          servicePort: 80
  tls:
  - hosts:
    - myblog.devops.cn
    secretName: https-secret
</code></pre>
<p>  然后访问 <a href="https://myblog.devops.cn/blog/index/" target="_blank">https://myblog.devops.cn/blog/index/</a></p>
                <div>
                    <hr>

标题：Kubernetes服务访问<br>
作者：<a href="https://cuijianzhe.github.io" target="_blank">cuijianzhe</a><br>
地址：<a href="https://cuijianzhe.github.io/articles/2020/04/23/1587624487440.html" target="_blank">https://cuijianzhe.github.io/articles/2020/04/23/1587624487440.html</a><br>

<!-- 签名档内可使用 HTML、JavaScript -->
<br>
<pre><p style="font-size:15px"><font color="#008000">
<b>到头来
我们记住的
不是敌人的攻击
而是朋友的沉默
       ---马丁·路德·金</b></p><pre>

                </div>
        </div>
    </div>
    <div class="post__toc">
<ul class="article__toc">
        <li class="toc__h1">
            <a href="#Service-负载均衡之Cluster-IP">Service 负载均衡之 Cluster IP</a>
        </li>
        <li class="toc__h3">
            <a href="#服务发现">服务发现</a>
        </li>
        <li class="toc__h3">
            <a href="#服务发现实现-">服务发现实现：</a>
        </li>
        <li class="toc__h2">
            <a href="#Service负载均衡之NodePort">Service 负载均衡之 NodePort</a>
        </li>
        <li class="toc__h3">
            <a href="#kube-proxy">kube-proxy</a>
        </li>
        <li class="toc__h2">
            <a href="#Kubernetes服务访问之Ingress">Kubernetes 服务访问之 Ingress</a>
        </li>
        <li class="toc__h3">
            <a href="#实现逻辑">实现逻辑</a>
        </li>
        <li class="toc__h3">
            <a href="#安装">安装</a>
        </li>
        <li class="toc__h4">
            <a href="#更新myblog的yaml文件容忍度">更新 myblog 的 YAML 文件容忍度</a>
        </li>
        <li class="toc__h4">
            <a href="#打标签">打标签</a>
        </li>
        <li class="toc__h3">
            <a href="#访问">访问</a>
        </li>
        <li class="toc__h3">
            <a href="#自签名证书">自签名证书</a>
        </li>
</ul>    </div>
    <div class="body--gray post__gray">
        <div class="wrapper comment">
                <div id="gitalk-container" style="padding: 30px 0;"></div>
                <div id="b3logsolocomments"></div>
                <div id="vcomment" style="padding: 30px 0;" data-name="cuijianzhe" data-postId="1587624487440"></div>

            <div class="post__list fn__flex">
                <div class="fn__flex-1">
                    <div id="externalRelevantArticles"></div>
                </div>
                <div class="post__list-mid fn__flex-1">
                    <div id="randomArticles"></div>
                </div>
                <div class="fn__flex-1">
                    <div id="relevantArticles"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="post__fix">
        <div class="wrapper">
            <span class="post__share mobile__none">
                Share
                <span class="tag tag--4" data-type="weibo">WeiBo</span>
                <span class="tag tag--5" data-type="twitter">Twitter</span>
                <span class="tag tag--6" data-type="qqz">QZone</span>
                <span class="post__code tag tag--7"
                      data-type="wechat"
                      data-title="Kubernetes服务访问"
                      data-blogtitle="邯城往事"
                      data-url="https://cuijianzhe.github.io/articles/2020/04/23/1587624487440.html"
                      data-avatar="https://img.hacpai.com/avatar/1551626533851_1579241477243.png?imageView2/1/w/128/h/128/interlace/0/q/100">
                    WeChat
                    <span class="qrcode"></span>
                </span>
            </span>
            <span class="post__arrow">
                    <a href="https://cuijianzhe.github.io/articles/2020/04/22/1587528230774.html" rel="prev"
                       class="vditor-tooltipped__n vditor-tooltipped"
                       pjax-title="KUbernets实践之pod控制器"
                       aria-label="旧一篇: KUbernets实践之pod控制器">←</a>

                    <a href="https://cuijianzhe.github.io/articles/2020/04/25/1587784213122.html" rel="next"
                       class="vditor-tooltipped__n vditor-tooltipped"
                       pjax-title="Gitlab迁移"
                       aria-label="新一篇: Gitlab迁移">→</a>
                <a href="javascript:Util.goTop()" class="vditor-tooltipped__n vditor-tooltipped"
                   aria-label="移动到顶部">↑</a>
                <a href="javascript:Util.goBottom()" class="vditor-tooltipped__n vditor-tooltipped"
                   aria-label="移动到底部">↓</a>
            </span>
        </div>
    </div>
    
</main>
<footer class="footer">
    <div class="ft__center">
    <a href="https://hacpai.com/member/cuijianzhe"
       aria-label="https://hacpai.com/member/cuijianzhe"
       class="vditor-tooltipped__n vditor-tooltipped  user__site"
       target="_blank" rel="noopener nofollow">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path fill="#d23f31" style="fill: var(--color1, #d23f31)" d="M5.787 17.226h17.033l5.954 9.528c0.47 0.752 0.003 1.361-1.042 1.361h-15.141z"></path>
            <path d="M10.74 3.927h17.033c1.045 0 1.512 0.609 1.042 1.361l-5.954 9.528h-19.872l6.379-10.209c0.235-0.376 0.849-0.681 1.372-0.681z"></path>
            <path d="M2.953 17.226h2.839l6.804 10.889h-1.892c-0.523 0-1.137-0.305-1.372-0.681z"></path>
        </svg>
    </a>

        <a href="https://github.com/cuijianzhe"
           aria-label="https://github.com/cuijianzhe"
           class="vditor-tooltipped__n vditor-tooltipped  user__site"
           target="_blank" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M16 0.331c-8.836 0-16 7.163-16 16 0 7.069 4.585 13.067 10.942 15.182 0.8 0.148 1.094-0.347 1.094-0.77 0-0.381-0.015-1.642-0.022-2.979-4.452 0.968-5.391-1.888-5.391-1.888-0.728-1.849-1.776-2.341-1.776-2.341-1.452-0.993 0.11-0.973 0.11-0.973 1.606 0.113 2.452 1.649 2.452 1.649 1.427 2.446 3.743 1.739 4.656 1.33 0.143-1.034 0.558-1.74 1.016-2.14-3.554-0.404-7.29-1.777-7.29-7.907 0-1.747 0.625-3.174 1.649-4.295-0.166-0.403-0.714-2.030 0.155-4.234 0 0 1.344-0.43 4.401 1.64 1.276-0.355 2.645-0.532 4.005-0.539 1.359 0.006 2.729 0.184 4.008 0.539 3.054-2.070 4.395-1.64 4.395-1.64 0.871 2.204 0.323 3.831 0.157 4.234 1.026 1.12 1.647 2.548 1.647 4.295 0 6.145-3.743 7.498-7.306 7.895 0.574 0.497 1.085 1.47 1.085 2.963 0 2.141-0.019 3.864-0.019 4.391 0 0.426 0.288 0.925 1.099 0.768 6.354-2.118 10.933-8.113 10.933-15.18 0-8.837-7.164-16-16-16z"></path>
            </svg>
        </a>

        <a href="https://twitter.com/JianzheC"
           aria-label="https://twitter.com/JianzheC"
           target="_blank"
           class="vditor-tooltipped__n vditor-tooltipped  user__site" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M32.003 6.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path>
            </svg>
        </a>
        <a href="https://weibo.com/3796930704"
           aria-label="https://weibo.com/3796930704"
           target="_blank"
           class="vditor-tooltipped__n vditor-tooltipped  user__site" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M13.444 27.064c-5.3 0.525-9.875-1.875-10.219-5.35-0.344-3.481 3.675-6.719 8.969-7.244 5.3-0.525 9.875 1.875 10.212 5.35 0.35 3.481-3.669 6.725-8.963 7.244zM24.038 15.521c-0.45-0.137-0.762-0.225-0.525-0.819 0.512-1.287 0.563-2.394 0.006-3.188-1.038-1.481-3.881-1.406-7.137-0.037 0 0-1.025 0.444-0.762-0.363 0.5-1.613 0.425-2.956-0.356-3.737-1.769-1.769-6.469 0.069-10.5 4.1-3.013 3.006-4.763 6.212-4.763 8.981 0 5.287 6.787 8.506 13.425 8.506 8.7 0 14.494-5.056 14.494-9.069 0-2.431-2.044-3.806-3.881-4.375z"></path>
                <path d="M29.819 5.833c-2.1-2.331-5.2-3.219-8.063-2.612v0c-0.663 0.144-1.081 0.794-0.938 1.45 0.144 0.662 0.788 1.081 1.45 0.938 2.038-0.431 4.238 0.2 5.731 1.856s1.9 3.913 1.256 5.888v0c-0.206 0.644 0.144 1.331 0.788 1.544 0.644 0.206 1.331-0.144 1.544-0.787v-0.006c0.9-2.762 0.331-5.938-1.769-8.269z"></path>
                <path d="M26.588 8.752c-1.025-1.138-2.538-1.569-3.925-1.269-0.569 0.119-0.931 0.688-0.813 1.256 0.125 0.569 0.688 0.931 1.25 0.806v0c0.681-0.144 1.419 0.069 1.919 0.619 0.5 0.556 0.637 1.313 0.419 1.975v0c-0.175 0.55 0.125 1.15 0.681 1.331 0.556 0.175 1.15-0.125 1.331-0.681 0.438-1.356 0.163-2.906-0.863-4.037z"></path>
                <path d="M13.738 20.771c-0.188 0.319-0.594 0.469-0.912 0.337-0.319-0.125-0.412-0.488-0.231-0.794 0.188-0.306 0.581-0.456 0.894-0.337 0.313 0.113 0.425 0.469 0.25 0.794zM12.044 22.933c-0.512 0.819-1.613 1.175-2.438 0.8-0.813-0.369-1.056-1.319-0.544-2.119 0.506-0.794 1.569-1.15 2.388-0.806 0.831 0.356 1.1 1.3 0.594 2.125zM13.969 17.146c-2.519-0.656-5.369 0.6-6.463 2.819-1.119 2.262-0.037 4.781 2.506 5.606 2.638 0.85 5.75-0.456 6.831-2.894 1.069-2.394-0.262-4.85-2.875-5.531z"></path>
            </svg>
        </a>
        <a href="https://www.zhihu.com/people/wen-yang-24-36"
           aria-label="https://www.zhihu.com/people/wen-yang-24-36"
           target="_blank"
           class="vditor-tooltipped__n vditor-tooltipped  user__site" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M32 26.67c0 2.931-2.382 5.33-5.33 5.33h-21.339c-2.948 0-5.33-2.382-5.33-5.33v-21.339c0-2.948 2.382-5.33 5.33-5.33h21.339c2.948 0 5.33 2.382 5.33 5.33v21.339zM12.358 17.191h4.713c0-1.114-0.531-1.748-0.531-1.748h-4.079c0.103-2.005 0.189-4.576 0.223-5.536h3.874s-0.017-1.645-0.463-1.645h-6.822s0.411-2.142 0.96-3.085c0 0-2.040-0.12-2.742 2.605-0.686 2.725-1.731 4.354-1.851 4.662s0.6 0.137 0.891 0c0.309-0.137 1.663-0.617 2.057-2.537h2.108c0.034 1.2 0.12 4.885 0.086 5.536h-4.336c-0.6 0.446-0.823 1.748-0.823 1.748h4.971c-0.206 1.371-0.566 3.137-1.080 4.062-0.806 1.491-1.234 2.828-4.131 5.176 0 0-0.48 0.36 0.994 0.223 1.474-0.12 2.845-0.514 3.839-2.434 0.514-0.994 1.011-2.28 1.423-3.565l4.079 4.713s0.548-1.268 0.137-2.657l-3.034-3.394-1.028 0.754c0.291-0.994 0.497-1.988 0.548-2.845 0.017 0.017 0.017 0 0.017-0.034zM18.048 7.936v16.3h1.714l0.703 1.954 2.965-1.954h3.754v-16.3h-9.136zM25.401 22.487h-1.937l-2.434 1.611-0.566-1.611h-0.6v-12.735h5.553v12.735h-0.017z"></path>
            </svg>
        </a>
        <a href="tencent://message/?uin=598941324"
           aria-label="598941324"
           target="_blank"
           class="vditor-tooltipped__n vditor-tooltipped  user__site" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M4.821 14.393c-0.125-0.304-0.143-0.607-0.143-0.929 0-0.5 0.321-1.304 0.625-1.679-0.018-0.464 0.179-1.411 0.536-1.714 0-3.304 2.554-7.464 5.536-8.893 1.839-0.875 3.768-1.179 5.786-1.179 1.571 0 3.286 0.375 4.75 0.982 4.196 1.768 5.143 5.054 6.036 9.25l0.018 0.089c0.518 0.786 0.982 1.714 0.982 2.679 0 0.482-0.321 0.964-0.321 1.393 0 0.036 0.107 0.179 0.125 0.214 1.536 2.268 2.929 4.732 2.929 7.554 0 0.625-0.339 2.804-1.339 2.804-0.696 0-1.464-1.696-1.714-2.161-0.018-0.018-0.036-0.018-0.054-0.018l-0.089 0.071c-0.571 1.482-1.196 2.875-2.357 3.982 1.018 0.982 2.661 0.893 2.964 2.589-0.089 0.196-0.054 0.411-0.196 0.607-1.018 1.536-3.75 1.732-5.393 1.732-2.179 0-3.946-0.571-6-1.179-0.429-0.125-1.071-0.054-1.536-0.107-1.089 1.196-3.75 1.518-5.286 1.518-1.357 0-6.607-0.089-6.607-2.411 0-1 0.214-1.286 0.911-1.929 0.554-0.107 0.964-0.411 1.607-0.446 0.089 0 0.161-0.018 0.25-0.036 0.018-0.018 0.036-0.018 0.036-0.071l-0.036-0.054c-1.232-0.286-2.964-3.393-3.232-4.679l-0.089-0.054c-0.125 0-0.179 0.268-0.214 0.357-0.393 0.911-1.321 1.893-2.357 2h-0.018c-0.143 0-0.089-0.143-0.196-0.179-0.25-0.589-0.411-1.125-0.411-1.786 0-3.571 1.714-6.214 4.5-8.321z"></path>
            </svg>
        </a>
        <a href="javascript:void(0)"
           class="vditor-tooltipped__n vditor-tooltipped  user__site" aria-label="cjz5989">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M9.062 9.203c0-0.859-0.562-1.422-1.422-1.422-0.844 0-1.703 0.562-1.703 1.422 0 0.844 0.859 1.406 1.703 1.406 0.859 0 1.422-0.562 1.422-1.406zM20.672 17.125c0-0.562-0.562-1.125-1.422-1.125-0.562 0-1.125 0.562-1.125 1.125 0 0.578 0.562 1.141 1.125 1.141 0.859 0 1.422-0.562 1.422-1.141zM16.984 9.203c0-0.859-0.562-1.422-1.406-1.422-0.859 0-1.703 0.562-1.703 1.422 0 0.844 0.844 1.406 1.703 1.406 0.844 0 1.406-0.562 1.406-1.406zM26.906 17.125c0-0.562-0.578-1.125-1.422-1.125-0.562 0-1.125 0.562-1.125 1.125 0 0.578 0.562 1.141 1.125 1.141 0.844 0 1.422-0.562 1.422-1.141zM22.75 10.922c-0.359-0.047-0.719-0.063-1.094-0.063-5.375 0-9.625 4.016-9.625 8.953 0 0.828 0.125 1.625 0.359 2.375-0.359 0.031-0.703 0.047-1.063 0.047-1.422 0-2.547-0.281-3.969-0.562l-3.953 1.984 1.125-3.406c-2.828-1.984-4.531-4.547-4.531-7.656 0-5.391 5.094-9.625 11.328-9.625 5.563 0 10.453 3.391 11.422 7.953zM32 19.687c0 2.547-1.688 4.813-3.969 6.516l0.859 2.828-3.109-1.703c-1.141 0.281-2.281 0.578-3.406 0.578-5.391 0-9.625-3.688-9.625-8.219s4.234-8.219 9.625-8.219c5.094 0 9.625 3.688 9.625 8.219z"></path>
            </svg>
        </a>
    </div>
    <nav class="footer__nav mobile__none">
            <a class="ft__link" href="/my-github-repos" target="_self" rel="section">
                我的开源
            </a>
            <a class="ft__link" href="http://fuck.cjzshilong.cn/time/time.html" target="_blank" rel="section">
                服务器倒计时
            </a>
        <a class="ft__link" rel="alternate" href="https://cuijianzhe.github.io/rss.xml" rel="section">RSS</a>
    </nav>
    <div class="footer__border mobile__none"></div>
    <div class="wrapper fn__flex">
        <div class="fn__flex-1 mobile__none">
            <div class="ft__fade">cuijianzhe -                >>>  展颜笑夙愿，一笑泯恩仇 <<<</div>
            <br>
                <!-- MetingJS音乐播放器 不能放到 head 导致系统功能加载异常-->
<link rel="stylesheet" href="//cdn.staticfile.org/aplayer/1.10.1/APlayer.min.css">
<script src="//cdn.staticfile.org/aplayer/1.10.1/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<meting-js server="netease" type="playlist" id="728729850"  autoplay="false" fixed ="true" order = "random"</meting-js>

<h1><p style="font-size:10px"><font color="#2F4F4F">红笺小字，说尽平生意。<br/>鸿雁在云鱼在水，惆怅此情难寄。<br/>             ——晏殊· 《清平乐》</font> </p></h1>

        </div>

            <div class="footer__mid fn__flex-1 mobile__none">
                <div class="ft__fade">分类</div>
                <br>
                    <a href="https://cuijianzhe.github.io/category/python"
                       aria-label="33 文章"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        人生苦短,我用Python</a> &nbsp; &nbsp;
                    <a href="https://cuijianzhe.github.io/category/java"
                       aria-label="15 文章"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        Java是世界上最好的语言</a> &nbsp; &nbsp;
                    <a href="https://cuijianzhe.github.io/category/linux"
                       aria-label="49 文章"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        Linux系列</a> &nbsp; &nbsp;
                    <a href="https://cuijianzhe.github.io/category/network"
                       aria-label="4 文章"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        Network系列</a> &nbsp; &nbsp;
                    <a href="https://cuijianzhe.github.io/category/young"
                       aria-label="6 文章"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        江湖就是人情世故</a> &nbsp; &nbsp;
            </div>

        <div class="fn__flex-1 footer__copyright">
            <a class="ft__link" href="https://cuijianzhe.github.io/archives.html">
                141
                文章
            </a>
           <br>
            <span data-uvstaturl="https://cuijianzhe.github.io">92571</span> <span class="ft-gray">浏览</span>
 <br>
            &copy; 2020
            <a class="ft__link" href="https://cuijianzhe.github.io">邯城往事</a>
            <img style="width: 20px; height: 20px;" src="https://img.hacpai.com/file/2019/10/jinghuibeian-30e807bb.png" alt="备案标识" /><a href="http://beian.miit.gov.cn" target="_blank" rel="nofollow noopener">冀ICP备19005901号</a> 

<!--切换标签实现网页标题变化-->
<script type="text/javascript">
    /*自动刷新页面，避免无法访问*/
    var OriginTitile = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function () {
        if (document.hidden) {
            document.title = '一杯茶，一包烟，混过一天是一天';
            clearTimeout(titleTime);
        } else {
            document.title = '哈哈，我是大佬ヾ(ﾟ∀ﾟゞ)';
            titleTime = setTimeout(function () {
                document.title = OriginTitile;
            }, 3000);
        }
    });
</script>
<!--切换标签实现网页标题变化 结束-->

        </div>
    </div>
</footer>
<script>
  var Label = {
    speech: true,
    servePath: "https://cuijianzhe.github.io",
    staticServePath: "https://cdn.jsdelivr.net/gh/88250/solo@dee9f7f/src/main/resources",
    luteAvailable: true,
    hljsStyle: 'monokai',
    langLabel: "zh_CN",
    version: "4.3.0",
    staticSite: true,
    showCodeBlockLn: false,
    articleId: "1587624487440",
  }
</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/88250/solo@dee9f7f/src/main/resources/skins/Pinghsu/js/headroom.min.js"></script>
<script type="text/javascript"
        src="https://cdn.jsdelivr.net/gh/88250/solo@dee9f7f/src/main/resources/skins/Pinghsu/js/common.min.js?1597690831817"
        charset="utf-8"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.9/index.css"/>
<script async src="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.9/index.js"></script>
<div class="solo-kanbanniang">
    <div class="solo-kanbanniang__tip"></div>
    <canvas id="soloKanbanniang" width="280" height="250"></canvas>
    <div class="solo-kanbanniang__tool">
        <svg id="soloKanbanniangHome" viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M32 18.967l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18.516v12h-8v-8h-8v8h-8v-12l12-9z"></path>
        </svg>
        <svg id="soloKanbanniangRSS" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M320.364 768q0 45.728-32 77.728t-77.728 32-77.728-32-32-77.728 32-77.728 77.728-32 77.728 32 32 77.728zM612.94 838.272q1.152 16-9.728 27.424-10.272 12-26.848 12h-77.152q-14.272 0-24.576-9.44t-11.424-23.712q-12.576-130.848-105.44-223.712t-223.712-105.44q-14.272-1.152-23.712-11.424t-9.44-24.576V402.24q0-16.576 12-26.848 9.728-9.728 24.576-9.728h2.848q91.424 7.424 174.848 46.016t148 103.712q65.152 64.576 103.712 148t46.016 174.848z m292.576 1.152q1.152 15.424-10.272 26.848-10.272 11.424-26.272 11.424h-81.728q-14.848 0-25.44-10.016t-11.136-24.288q-6.848-122.848-57.728-233.44t-132.288-192-192-132.288-233.44-58.272q-14.272-0.576-24.288-11.136t-10.016-24.864V109.664q0-16 11.424-26.272 10.272-10.272 25.152-10.272h1.728q149.728 7.424 286.56 68.576t243.136 168q106.848 106.272 168 243.136t68.576 286.56z"></path>
        </svg>
        <svg id="soloKanbanniangChat" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M802.42709 96.163153H219.476155c-84.48109 0-154.896836 71.746044-154.896836 157.840888v393.119449c0 86.072331 70.415746 157.819398 154.896836 157.819399h214.038818V925.470963s22.526039 40.168862 64.767096 5.734608c30.965246-25.819039 126.721123-91.828428 171.775248-123.385145h132.369773c84.502579 0 154.896836-83.21526 154.896836-157.839865V251.125481c0-86.094844-70.394257-154.962328-154.896836-154.962328zM301.144176 518.002714c-39.427988 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044 39.426965 0 70.393233 31.577183 70.393234 71.746044 0 40.169885-30.966269 71.746044-70.393234 71.746044z m208.411657 0c-39.450501 0-70.415746-31.576159-70.415746-71.746044 0-40.168862 30.965246-71.746044 70.415746-71.746044 39.405475 0 70.394257 31.577183 70.394257 71.746044 0 40.169885-30.988782 71.746044-70.394257 71.746044z m211.203236 0c-39.426965 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044s70.415746 31.577183 70.415746 71.746044c-0.001023 40.169885-30.988782 71.746044-70.415746 71.746044z"></path>
        </svg>
        <svg id="soloKanbanniangChange" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M936.672 193.216l-226.88-64c-8.704-2.528-18.112-1.12-25.824 3.776-7.68 4.864-12.896 12.736-14.432 21.728C655.712 236.928 595.328 288 512 288c-71.424 0-142.464-103.296-163.776-143.104-7.136-13.28-22.528-19.84-37.024-15.68l-224 64C73.472 197.152 64 209.728 64 224v256a31.93 31.93 0 0 0 11.712 24.736c7.392 6.08 17.152 8.512 26.56 6.624L224 487.04V832c0 52.928 43.072 96 96 96h384c52.928 0 96-43.072 96-96V519.04l121.728 24.352c9.44 1.92 19.2-0.544 26.56-6.624C955.68 530.656 960 521.6 960 512V224c0-14.336-9.536-26.912-23.328-30.784zM672 800H352c-17.664 0-32-14.304-32-32s14.336-32 32-32h320c17.696 0 32 14.304 32 32s-14.304 32-32 32z"></path>
        </svg>
        <svg id="soloKanbanniangPhoto" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M898.048 258.048q23.552-1.024 46.592 9.216t40.96 27.136 28.672 39.424 10.752 46.08l0 390.144q0 24.576-10.752 47.104t-28.672 40.448-40.96 28.16-47.616 10.24l-697.344 0q-24.576 0-48.64-10.24t-42.496-27.648-29.696-40.448-11.264-48.64l0-381.952q0-22.528 10.752-45.568t28.672-41.472 39.936-30.208 44.544-11.776l63.488 0 13.312-83.968q3.072-20.48 18.432-32.768t34.816-12.288l456.704 0q19.456 0 34.304 10.752t16.896 34.304l14.336 83.968 54.272 0zM548.864 712.704q40.96 0 77.824-15.872t63.488-42.496 42.496-62.976 15.872-77.312-15.872-77.312-42.496-62.976-63.488-42.496-77.824-15.872-77.312 15.872-63.488 42.496-43.008 62.976-15.872 77.312 15.872 77.312 43.008 62.976 63.488 42.496 77.312 15.872z"></path>
        </svg>
        <svg id="soloKanbanniangGithub" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M1024 524.8c0 114.346667-32.554667 217.216-97.706667 308.565333-65.066667 91.306667-149.162667 154.538667-252.288 189.610667-11.989333 2.304-20.778667 0.682667-26.325333-4.778667a27.605333 27.605333 0 0 1-8.362667-20.48v-144.213333c0-44.16-11.52-76.501333-34.645333-97.024 25.344-2.730667 48.085333-6.826667 68.309333-12.288a268.629333 268.629333 0 0 0 62.72-26.666667 187.434667 187.434667 0 0 0 53.973334-45.44c14.421333-18.005333 26.197333-41.898667 35.328-71.765333 9.088-29.824 13.653333-64.128 13.653333-102.826667 0-55.125333-17.536-102.058667-52.650667-140.8 16.426667-41.429333 14.677333-87.893333-5.333333-139.392-12.458667-4.096-30.464-1.578667-54.016 7.509334a355.328 355.328 0 0 0-61.312 30.08L640 271.274667a462.336 462.336 0 0 0-128-17.749334c-43.989333 0-86.656 5.930667-128 17.749334a589.824 589.824 0 0 0-28.330667-18.432c-11.776-7.253333-30.336-16.042667-55.68-26.325334-25.344-10.24-44.416-13.312-57.301333-9.216-19.584 51.498667-21.12 97.962667-4.693333 139.434667-35.114667 38.698667-52.650667 85.632-52.650667 140.757333 0 38.698667 4.565333 72.874667 13.653333 102.485334 9.130667 29.610667 20.778667 53.546667 34.986667 71.765333 14.250667 18.218667 32.128 33.493333 53.674667 45.781333 21.546667 12.288 42.453333 21.205333 62.677333 26.666667 20.224 5.461333 43.008 9.557333 68.309333 12.288-17.749333 16.384-28.629333 39.850667-32.64 70.4a130.005333 130.005333 0 0 1-29.994666 10.24c-10.666667 2.261333-23.338667 3.413333-37.973334 3.413333-14.72 0-29.269333-4.906667-43.690666-14.677333-14.464-9.813333-26.794667-24.064-36.992-42.709333a109.226667 109.226667 0 0 0-32.341334-35.541334c-13.141333-9.130667-24.106667-14.592-33.024-16.426666l-13.312-2.048c-9.344 0-15.786667 1.024-19.328 3.072-3.584 2.090667-4.693333 4.693333-3.328 7.893333 1.28 3.157333 3.328 6.4 5.973334 9.557333 2.688 3.2 5.546667 5.930667 8.661333 8.192l4.693333 3.413334c9.770667 4.565333 19.413333 13.226667 29.013334 25.984 9.514667 12.757333 16.512 24.362667 20.992 34.858666l6.656 15.701334c5.76 17.322667 15.530667 31.317333 29.312 42.026666 13.781333 10.666667 28.672 17.536 44.672 20.48 16 2.986667 31.445333 4.565333 46.336 4.821334 14.890667 0.213333 27.221333-0.597333 36.992-2.389334l15.36-2.730666c0 17.28 0.085333 37.546667 0.298666 60.8l0.341334 36.906666a27.050667 27.050667 0 0 1-8.661334 20.48c-5.76 5.461333-14.677333 7.082667-26.666666 4.778667-103.125333-35.072-187.221333-98.261333-252.330667-189.610667C32.554667 742.058667 0 639.146667 0 524.8c0-95.232 22.869333-183.04 68.693333-263.466667A516.266667 516.266667 0 0 1 254.976 70.4C333.44 23.466667 419.114667 0 512 0c92.885333 0 178.56 23.466667 256.981333 70.4a516.266667 516.266667 0 0 1 186.368 190.976C1001.130667 341.802667 1024 429.653333 1024 524.842667z"></path>
        </svg>
        <svg id="soloKanbanniangClose" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M517.572566143763 1018.6748601482986C238.26554897656422 1018.6748601482986 11.897910175114305 792.2714997690043 11.897910175114305 513.0002041796496c0-279.3070171671984 226.36763880144977-505.71037754649296 505.6746559686481-505.71037754649296 279.2712955893538 0 505.6746559686481 226.40336037929444 505.6746559686481 505.71037754649296C1023.2472221124112 792.2714997690043 796.8795833109612 1018.6748601482986 517.572566143763 1018.6748601482986zM754.7281214542927 339.25044954334646c13.752807470184345-13.752807470184345 9.680547595895998-40.186775075214015-9.073280772537204-58.94060344364717l-2.143294670678079-2.1075730928334457c-18.7538283684332-18.7538283684332-45.15207439561819-22.861809820566194-58.90488186580257-9.073280772537204l-168.21291007038468 168.24863164822932-180.42968969324974-180.46541127109438c-13.967136937252159-13.967136937252159-40.72259874288353-9.823433907274534-59.72647815622916 9.216167083915742l-2.143294670678079 2.143294670678079c-19.039600991190277 19.003879413345654-23.111860865478626 45.75934121897699-9.180445506071107 59.655035000539876l180.42968969324974 180.46541127109438-176.07165719620428 176.03593561835962c-13.788529048028984 13.824250625873615-9.716269173740633 40.151053497369375 9.073280772537204 58.94060344364717l2.1075730928334457 2.1075730928334457c18.7538283684332 18.7538283684332 45.15207439561819 22.897531398410823 58.90488186580257 9.073280772537204l176.10737877404887-176.10737877404887 170.39192631890742 170.42764789675192c13.967136937252159 13.931415359407513 40.686877165038865 9.85915548511917 59.690756578384516-9.180445506071107l2.1790162485227142-2.1790162485227142c19.039600991190277-18.968157835501014 23.147582443323273-45.72361964113239 9.180445506071107-59.690756578384516l-170.39192631890742-170.42764789675192L754.7281214542927 339.25044954334646z"></path>
        </svg>
    </div>
</div>



<script type="text/javascript">
    Util.addScript('https://cdn.jsdelivr.net/gh/88250/solo@dee9f7f/src/main/resources/js/page.min.js?1597690831817', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论不能为空",
        "oId": "1587624487440",
        "blogHost": "https://cuijianzhe.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "5";
    page.loadRandomArticles('<h3>RECOMMEND POSTS</h3>');
    page.loadExternalRelevantArticles("kubernetes,Linux",
    '<h3>HACPAI POSTS</h3>');
    page.loadRelevantArticles('1587624487440', '<h3>RELEVANT POSTS</h3>');
Skin.initArticle()
    });
</script>

</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 454ms, 2020/08/18 17:54:42 -->