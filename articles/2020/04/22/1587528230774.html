<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>KUbernets实践之pod控制器 - 邯城往事</title><meta name="description" content="拒绝了所有人的邀请，不愿与除你之外的人看风景"/><meta property="og:description" content="拒绝了所有人的邀请，不愿与除你之外的人看风景"/>    <meta name="keywords" content="包容、开放、任性、桀骜"/><link rel="dns-prefetch" href="https://cdn.jsdelivr.net/gh/88250/solo@3e5209c/src/main/resources"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://cdn.jsdelivr.net/gh/88250/solo@3e5209c/src/main/resources"><link rel="icon" type="image/png" href="https://img.hacpai.com/file/2019/11/guohui-e67e7b3b.png"/><link rel="apple-touch-icon" href="https://img.hacpai.com/file/2019/11/guohui-e67e7b3b.png"><link rel="shortcut icon" type="image/x-icon" href="https://img.hacpai.com/file/2019/11/guohui-e67e7b3b.png"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="KUbernets实践之pod控制器 - 邯城往事"/><meta property="og:site_name" content="邯城往事"/><meta property="og:url"      content="https://cuijianzhe.github.io/articles/2020/04/22/1587528230774.html?"/><meta property="og:image" content="https://img.hacpai.com/file/2019/11/guohui-e67e7b3b.png"/><link rel="search" type="application/opensearchdescription+xml" title="KUbernets实践之pod控制器 - 邯城往事" href="/opensearch.xml"><link href="https://cuijianzhe.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://cuijianzhe.github.io/manifest.json">        <link rel="canonical" href="https://cuijianzhe.github.io/articles/2020/04/22/1587528230774.html">        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/gh/88250/solo@3e5209c/src/main/resources/skins/Pinghsu/css/base.css?1617303621572"/>
            <link rel="prev" title="用Python实现widows下ping程序" href="https://cuijianzhe.github.io/articles/2020/04/18/1587188601330.html">
            <link rel="next" title="Kubernetes服务访问" href="https://cuijianzhe.github.io/articles/2020/04/23/1587624487440.html">
    <!--鼠标点击特效-->
<script src="https://cdn.jsdelivr.net/gh/fz6m/Private-web@1.2/js/custom/click.min.js"></script>
<!--页面动态樱花-->
<!--script type="text/javascript"src="https://cdn.jsdelivr.net/gh/fz6m/Private-web@1.2/js/sakura/sakura-original.js"--></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vditor@3.8.4/dist/js/icons/ant.js" async="" id="vditorIconScript"></script></head>
<body>
<header class="header">
    <div class="wrapper">
        <a href="https://cuijianzhe.github.io" rel="start" class="header__logo">
            <img src="https://img.hacpai.com/avatar/1551626533851_1579241477243.png?imageView2/1/w/128/h/128/interlace/0/q/100" alt="邯城往事"/>
            邯城往事
        </a>

        <nav class="header__nav mobile__none">
            <a href="https://cuijianzhe.github.io/tags.html" rel="section">
                Tags
            </a>
            <a href="https://cuijianzhe.github.io/archives.html">
                Archives
            </a>
            <a rel="archive" href="https://cuijianzhe.github.io/links.html">
                Links
            </a>
        </nav>

        <div class="header__bar fn__none" onclick="$(this).next().slideToggle()">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                <path fill="#444" d="M0 3h20v2h-20v-2zM0 9h20v2h-20v-2zM0 15h20v2h-20v-2z"></path>
            </svg>
        </div>
        <main class="header__menu fn__none">
            <ul>
                    <li>
                        <a href="/my-github-repos" target="_self" rel="section">
                            我的开源
                        </a>
                    </li>
                    <li>
                        <a href="http://times.cjzshilong.cn/time/time.html" target="_blank" rel="section">
                            服务器倒计时
                        </a>
                    </li>
                <li>
                    <a href="https://cuijianzhe.github.io/tags.html" rel="section">
                        Tags
                    </a>
                </li>
                <li>
                    <a href="https://cuijianzhe.github.io/archives.html">
                        Archives
                    </a>
                </li>
                <li>
                    <a rel="archive" href="https://cuijianzhe.github.io/links.html">
                        Links
                    </a>
                </li>
                <li>
                    <a rel="alternate" href="https://cuijianzhe.github.io/rss.xml" rel="section">
                        RSS
                    </a>
                </li>
            </ul>
        </main>
    </div>
</header>
<main id="pjax" class="fn__flex-1">
    
    <div class="post wrapper wrapper--miner">
        <h2 class="item__title">
            <a rel="bookmark" href="https://cuijianzhe.github.io/articles/2020/04/22/1587528230774.html">
                KUbernets实践之pod控制器
            </a>
        </h2>
        <div class="ft__fade item__meta">
                Updated on
            <time>
                Apr 30, 2020
            </time>
                in <a href="https://cuijianzhe.github.io/category/linux">Linux系列</a>
            with <span data-uvstaturl="https://cuijianzhe.github.io/articles/2020/04/22/1587528230774.html">0</span> views
                and <a href="#b3logsolocomments"><span data-uvstatcmt="1587528230774">0</span> comments</a>
        </div>
        <div class="item__tags">
                <a rel="tag" class="tag tag--0" href="https://cuijianzhe.github.io/tags/Linux">
                    <b># Linux</b>
                </a>
                <a rel="tag" class="tag tag--1" href="https://cuijianzhe.github.io/tags/kubernets">
                    <b># kubernets</b>
                </a>
        </div>
        <div class="vditor-reset">
            <h1 id="为什么用pod控制器-">为什么用 pod 控制器？</h1>
<p class="indent--2">只使用 Pod, 将会面临如下需求:</p>
<ol>
<li>业务应用启动多个副本</li>
<li>Pod 重建后 IP 会变化，外部如何访问 Pod 服务</li>
<li>运行业务 Pod 的某个节点挂了，可以自动帮我把 Pod 转移到集群中的可用节点启动起来</li>
<li>我的业务应用功能是收集节点监控数据,需要把 Pod 运行在 k8 集群的各个节点上</li>
</ol>
<h1 id="Workload--工作负载-">Workload (工作负载)</h1>
<p class="indent--2">控制器又称工作负载是用于实现管理 pod 的中间层，确保 pod 资源符合预期的状态，pod 的资源出现故障时，会尝试 进行重启，当根据重启策略无效，则会重新新建 pod 的资源。</p>
<p class="indent--2"><img src="https://img.hacpai.com/file/2020/04/workload-6ee9309c.png?imageView2/2/w/1280/format/jpg/interlace/1/q/100" alt="workload.png"></p>
<ul>
<li>ReplicaSet: 代用户创建指定数量的 pod 副本数量，确保 pod 副本数量符合预期状态，并且支持滚动式自动扩容和缩容功能</li>
<li>Deployment：工作在 ReplicaSet 之上，用于管理无状态应用，目前来说最好的控制器。支持滚动更新和回滚功能，还提供声明式配置</li>
<li>DaemonSet：用于确保集群中的每一个节点只运行特定的 pod 副本，通常用于实现系统级后台任务。比如 ELK 服务</li>
<li>Job：只要完成就立即退出，不需要重启或重建</li>
<li>Cronjob：周期性任务控制，不需要持续后台运行</li>
<li>StatefulSet：管理有状态应用</li>
</ul>
<h2 id="Deployment">Deployment</h2>
<pre><code class="language-bash highlight-chroma"><span class="highlight-o">[</span>root@k8s-master deployment<span class="highlight-o">]</span><span class="highlight-c1"># cat deploy-mysql.yaml </span>
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql
  namespace: demo
spec:
  replicas: 1	<span class="highlight-c1">#指定Pod副本数</span>
  selector:		<span class="highlight-c1">#指定Pod的选择器</span>
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:	<span class="highlight-c1">#给Pod打label</span>
        app: mysql
    spec:
      hostNetwork: <span class="highlight-nb">true</span>	<span class="highlight-c1"># 声明pod的网络模式为host模式，效果通docker run --net=host</span>
      volumes: 
      - name: mysql-data
        hostPath: 
          path: /data/mysql/data
      nodeSelector:   <span class="highlight-c1"># 使用节点选择器将Pod调度到指定label的节点</span>
        component: mysql
      containers:
      - name: mysql
        image: 192.168.51.209:5000/mysql:5.7-utf8
        args:
        - <span class="highlight-s2">"--character-set-server=utf8"</span>     <span class="highlight-c1">#</span>
        - <span class="highlight-s2">"--collation-server=utf8_general_ci"</span>    <span class="highlight-c1">#  指定字符编码</span>
        ports:
        - containerPort: <span class="highlight-m">3306</span>
        env:
        - name: MYSQL_USER
          valueFrom:
            secretKeyRef:
              name: myblog
              key: MYSQL_USER
        - name: MYSQL_PASSWD
          valueFrom:
            secretKeyRef:
              name: myblog
              key: MYSQL_PASSWD
        - name: MYSQL_DATABASE
          value: <span class="highlight-s2">"myblog"</span>
        resources:
          requests:
            memory: 100Mi
            cpu: 50m
          limits:
            memory: 500Mi
            cpu: 100m
        readinessProbe:
          tcpSocket:
            port: <span class="highlight-m">3306</span>
          initialDelaySeconds: <span class="highlight-m">5</span>
          periodSeconds: <span class="highlight-m">10</span>
        livenessProbe:
          tcpSocket:
            port: <span class="highlight-m">3306</span>
          initialDelaySeconds: <span class="highlight-m">15</span>
          periodSeconds: <span class="highlight-m">20</span>
        volumeMounts:
        - name: mysql-data
          mountPath: /var/lib/mysql
</code></pre>
<pre><code class="language-bash highlight-chroma"><span class="highlight-o">[</span>root@k8s-master deployment<span class="highlight-o">]</span><span class="highlight-c1"># cat deploy-myblog.yaml</span>
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myblog
  namespace: demo
spec:
  replicas: 1	<span class="highlight-c1">#指定Pod副本数</span>
  selector:		<span class="highlight-c1">#指定Pod的选择器</span>
    matchLabels:
      app: myblog
  template:
    metadata:
      labels:	<span class="highlight-c1">#给Pod打label</span>
        app: myblog
    spec:
      containers:
      - name: myblog
        image: 192.168.51.209:5000/myblog
        imagePullPolicy: IfNotPresent
        env:
        - name: MYSQL_HOST
          valueFrom:
            configMapKeyRef:
              name: myblog
              key: MYSQL_HOST
        - name: MYSQL_PORT
          valueFrom:
            configMapKeyRef:
              name: myblog
              key: MYSQL_PORT
        - name: MYSQL_USER
          valueFrom:
            secretKeyRef:
              name: myblog
              key: MYSQL_USER
        - name: MYSQL_PASSWD
          valueFrom:
            secretKeyRef:
              name: myblog
              key: MYSQL_PASSWD
        ports:
        - containerPort: <span class="highlight-m">8002</span>
        resources:
          requests:
            memory: 100Mi
            cpu: 50m
          limits:
            memory: 500Mi
            cpu: 100m
        livenessProbe:
          httpGet:
            path: /blog/index/
            port: <span class="highlight-m">8002</span>
            scheme: HTTP
          initialDelaySeconds: <span class="highlight-m">10</span>  <span class="highlight-c1"># 容器启动后第一次执行探测是需要等待多少秒</span>
          periodSeconds: <span class="highlight-m">15</span> 	<span class="highlight-c1"># 执行探测的频率</span>
          timeoutSeconds: 2		<span class="highlight-c1"># 探测超时时间</span>
        readinessProbe: 

          httpGet: 
            path: /blog/index/
            port: <span class="highlight-m">8002</span>
            scheme: HTTP
          initialDelaySeconds: <span class="highlight-m">10</span> 
          timeoutSeconds: <span class="highlight-m">2</span>
          periodSeconds: <span class="highlight-m">15</span>
</code></pre>
<pre><code class="language-bash highlight-chroma"><span class="highlight-o">[</span>root@k8s-master deployment<span class="highlight-o">]</span><span class="highlight-c1"># cat configmap.yaml </span>
apiVersion: v1
kind: ConfigMap
metadata:
  name: myblog
  namespace: demo
data:
  MYSQL_HOST: <span class="highlight-s2">"192.168.51.210"</span>
  MYSQL_PORT: <span class="highlight-s2">"3306"</span>
<span class="highlight-o">[</span>root@k8s-master deployment<span class="highlight-o">]</span><span class="highlight-c1"># cat secret.yaml </span>
apiVersion: v1
kind: Secret
metadata:
  name: myblog
  namespace: demo
type: Opaque
data:
  MYSQL_USER: <span class="highlight-nv">cm9vdA</span><span class="highlight-o">==</span>
  MYSQL_PASSWD: MTIzNDU2
</code></pre>
<p class="indent--2"><strong>创建 Deployment</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl create -f deploy-mysql.yaml 
deployment.apps/mysql created
[root@k8s-master deployment]# kubectl create -f configmap.yaml 
configmap/myblog created
[root@k8s-master deployment]# kubectl create -f  secret.yaml 
secret/myblog created
[root@k8s-master deployment]# kubectl create -f deploy-myblog.yaml 
deployment.apps/myblog created
</code></pre>
<pre><code class="highlight-chroma">[root@k8s-master deployment]#  kubectl api-resources
[root@k8s-master deployment]# kubectl -n demo get deploy 
NAME     READY   UP-TO-DATE   AVAILABLE   AGE
myblog   1/1     1            1           3m9s
mysql    1/1     1            1           28h
</code></pre>
<ul>
<li><code>NAME</code> 列出了集群中 Deployments 的名称。</li>
<li><code>READY</code> 显示当前正在运行的副本数/期望的副本数。</li>
<li><code>UP-TO-DATE</code> 显示已更新以实现期望状态的副本数。</li>
<li><code>AVAILABLE</code> 显示应用程序可供用户使用的副本数。</li>
<li><code>AGE</code> 显示应用程序运行的时间量。</li>
</ul>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n demo get po
NAME                     READY   STATUS    RESTARTS   AGE
myblog-b66554b87-rms8b   1/1     Running   0          8m53s
mysql-8fcc5595f-dj4gb    1/1     Running   0          9m45s
</code></pre>
<p class="indent--2"><strong>命令指示：</strong></p>
<ul>
<li>删除 deploy：  <code>kubectl delete -n demo deploy myblog</code> 或者 <code>kubectl delete -f deploy-mysql.yaml</code></li>
<li>查看详情：<code>kubectl describe -n demo pod mysql-55745b9899-dpzrj</code></li>
</ul>
<h3 id="副本保障机制">副本保障机制</h3>
<p class="indent--2">controller 实时检测 pod 状态，并保障副本数一直处于期望的值。</p>
<h4 id="删除pod-观察pod状态变化">删除 pod，观察 pod 状态变化</h4>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n demo get pods -o wide
NAME                     READY   STATUS    RESTARTS   AGE     IP               NODE         NOMINATED NODE   READINESS GATES
myblog-b66554b87-zp9nf   1/1     Running   0          4m31s   10.244.2.12      k8s-slave2   &lt;none&gt;           &lt;none&gt;
mysql-8fcc5595f-trnx9    1/1     Running   0          28h     192.168.51.210   k8s-slave1   &lt;none&gt;           &lt;none&gt;
[root@k8s-master deployment]# 
[root@k8s-master deployment]# kubectl -n demo delete pod myblog-b66554b87-zp9nf 
pod "myblog-b66554b87-zp9nf" deleted
[root@k8s-master deployment]#  kubectl -n demo get pods -o wide -w
NAME                     READY   STATUS        RESTARTS   AGE     IP               NODE         NOMINATED NODE   READINESS GATES
myblog-b66554b87-phv4x   1/1     Running       0          30s     10.244.2.13      k8s-slave2   &lt;none&gt;           &lt;none&gt;
myblog-b66554b87-zp9nf   1/1     Terminating   0          5m28s   10.244.2.12      k8s-slave2   &lt;none&gt;           &lt;none&gt;
mysql-8fcc5595f-trnx9    1/1     Running       0          28h     192.168.51.210   k8s-slave1   &lt;none&gt;           &lt;none&gt;
myblog-b66554b87-zp9nf   0/1     Terminating   0          5m30s   &lt;none&gt;           k8s-slave2   &lt;none&gt;           &lt;none&gt;
myblog-b66554b87-zp9nf   0/1     Terminating   0          5m30s   &lt;none&gt;           k8s-slave2   &lt;none&gt;           &lt;none&gt;
myblog-b66554b87-zp9nf   0/1     Terminating   0          5m42s   &lt;none&gt;           k8s-slave2   &lt;none&gt;           &lt;none&gt;
myblog-b66554b87-zp9nf   0/1     Terminating   0          5m42s   &lt;none&gt;           k8s-slave2   &lt;none&gt;           &lt;none&gt;
[root@k8s-master deployment]# kubectl -n demo get pods -o wide
NAME                     READY   STATUS    RESTARTS   AGE   IP               NODE         NOMINATED NODE   READINESS GATES
myblog-b66554b87-phv4x   1/1     Running   0          73s   10.244.2.13      k8s-slave2   &lt;none&gt;           &lt;none&gt;
mysql-8fcc5595f-trnx9    1/1     Running   0          28h   192.168.51.210   k8s-slave1   &lt;none&gt;           &lt;none&gt;
</code></pre>
<h4 id="设置两个副本--或者通过的方式-最好通过修改文件-然后apply的方式-这样yaml文件可以保持同步">设置两个副本, 或者通过 <code>kubectl -n demo edit deploy myblog</code> 的方式，最好通过修改文件，然后 apply 的方式，这样 YAML 文件可以保持同步</h4>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n demo scale deploy myblog --replicas=2
deployment.apps/myblog scaled
</code></pre>
<p class="indent--2"><strong>观察 pods</strong></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# kubectl -n demo get pods -o wide
NAME                     READY   STATUS    RESTARTS   AGE     IP               NODE         NOMINATED NODE   READINESS GATES
myblog-b66554b87-jg9k8   1/1     Running   0          49s     10.244.1.25      k8s-slave1   &lt;none&gt;           &lt;none&gt;
myblog-b66554b87-phv4x   1/1     Running   0          4m17s   10.244.2.13      k8s-slave2   &lt;none&gt;           &lt;none&gt;
mysql-8fcc5595f-trnx9    1/1     Running   0          28h     192.168.51.210   k8s-slave1   &lt;none&gt;           &lt;none&gt;
</code></pre>
<h3 id="Pod驱逐策略">Pod 驱逐策略</h3>
<p class="indent--2">K8S 有个特色功能叫 pod eviction，它在某些场景下如节点 NotReady，或者资源不足时，把 pod 驱逐至其它节点，这也是出于业务保护的角度去考虑的。</p>
<ol>
<li>Kube-controller-manager: 周期性检查所有节点状态，当节点处于 NotReady 状态超过一段时间后，驱逐该节点上所有 pod。停掉 kubelet</li>
</ol>
<ul>
<li><code>pod-eviction-timeout</code>：NotReady 状态节点超过该时间后，执行驱逐，默认 5 min</li>
</ul>
<ol start="2">
<li>Kubelet: 周期性检查本节点资源，当资源不足时，按照优先级驱逐部分 pod</li>
</ol>
<ul>
<li><code>memory.available</code>：节点可用内存</li>
<li><code>nodefs.available</code>：节点根盘可用存储空间</li>
<li><code>nodefs.inodesFree</code>：节点 inodes 可用数量</li>
<li><code>imagefs.available</code>：镜像存储盘的可用空间</li>
<li><code>imagefs.inodesFree</code>：镜像存储盘的 inodes 可用数量</li>
</ul>
<h4 id="服务更新">服务更新</h4>
<p class="indent--2">修改 dockerfile，重新打 tag 模拟服务更新。<br>
更新方式：</p>
<ul>
<li>修改 YAML 文件，使用 <code>kubectl -n demo apply -f deploy-myblog.yaml</code> 来应用更新</li>
<li><code>kubectl -n demo edit deploy myblog</code> 在线更新</li>
<li><code>kubectl set image deploy myblog myblog=192.168.51.209:5000/myblog:v2 --record</code></li>
</ul>
<h4 id="修改测试文件">修改测试文件</h4>
<p class="indent--2">$ vi mybolg/blog/template/index.html</p>
<p class="indent--2"><span class="language-math"> docker build . -t 192.168.51.209:5000/myblog:v2 -f Dockerfile_optimized
</span> docker push 192.168.51.209:5000/myblog:v2</p>
<h3 id="更新策略">更新策略</h3>
<pre><code class="highlight-chroma">...
spec:
  replicas: 2	#指定Pod副本数
  selector:		#指定Pod的选择器
    matchLabels:
      app: myblog
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate		#指定更新方式为滚动更新，默认策略，通过get deploy yaml查看
    ...
</code></pre>
<p class="indent--2"><img src="https://img.hacpai.com/file/2020/04/update-eef5c14a.png?imageView2/2/w/1280/format/jpg/interlace/1/q/100" alt="update.png"><br>
策略控制：</p>
<ul>
<li>maxSurge：最大激增数, 指更新过程中, 最多可以比 replicas 预先设定值多出的 pod 数量, 可以为固定值或百分比,默认为 desired Pods 数的 25%。计算时向上取整(比如 3.4，取 4)，更新过程中最多会有 replicas + maxSurge 个 pod</li>
<li>maxUnavailable： 指更新过程中, 最多有几个 pod 处于无法服务状态 , 可以为固定值或百分比，默认为 desired Pods 数的 25%。计算时向下取整(比如 3.6，取 3)</li>
</ul>
<p class="indent--2"><em>在 Deployment rollout 时，需要保证 Available(Ready) Pods 数不低于 desired pods number - maxUnavailable; 保证所有的非异常状态 Pods 数不多于 desired pods number + maxSurge</em>。</p>
<p class="indent--2">以 myblog 为例，使用默认的策略，更新过程:</p>
<ol>
<li>maxSurge 25%，2 个实例，向上取整，则 maxSurge 为 1，意味着最多可以有 2+1=3 个 Pod，那么此时会新创建 1 个 ReplicaSet，RS-new，把副本数置为 1，此时呢，副本控制器就去创建这个新的 Pod</li>
<li>同时，maxUnavailable 是 25%，副本数 2*25%，向下取整，则为 0，意味着，滚动更新的过程中，不能有少于 2 个可用的 Pod，因此，旧的 Replica（RS-old）会先保持不动，等 RS-new 管理的 Pod 状态 Ready 后，此时已经有 3 个 Ready 状态的 Pod 了，那么由于只要保证有 2 个可用的 Pod 即可，因此，RS-old 的副本数会有 2 个变成 1 个，此时，会删掉一个旧的 Pod</li>
<li>删掉旧的 Pod 的时候，由于总的 Pod 数量又变成 2 个了，因此，距离最大的 3 个还有 1 个 Pod 可以创建，所以，RS-new 把管理的副本数由 1 改成 2，此时又会创建 1 个新的 Pod，等 RS-new 管理了 2 个 Pod 都 ready 后，那么就可以把 RS-old 的副本数由 1 置为 0 了，这样就完成了滚动更新</li>
</ol>
<h4 id="查看滚动更新事件">查看滚动更新事件</h4>
<p class="indent--2"><code>kubectl -n demo describe deploy myblog</code></p>
<h3 id="服务回滚">服务回滚</h3>
<p class="indent--2">通过滚动升级的策略可以平滑的升级 Deployment，若升级出现问题，需要最快且最好的方式回退到上一次能够提供正常工作的版本。为此 K8S 提供了回滚机制。</p>
<p class="indent--2"><strong>revision</strong>：更新应用时，K8S 都会记录当前的版本号，即为 revision，当升级出现问题时，可通过回滚到某个特定的 revision，默认配置下，K8S 只会保留最近的几个 revision，可以通过 Deployment 配置文件中的 spec.revisionHistoryLimit 属性增加 revision 数量，默认是 10。</p>
<p class="indent--2"><strong>查看当前</strong>：</p>
<pre><code class="highlight-chroma">$ kubectl -n demo rollout history deploy myblog ##CHANGE-CAUSE为空
$ kubectl delete -f deploy-myblog.yaml    ## 方便演示到具体效果，删掉已有deployment
</code></pre>
<p class="indent--2"><strong>记录回滚：</strong></p>
<pre><code class="highlight-chroma">$ kubectl create -f deploy-myblog.yaml --record
$ kubectl -n demo set image deploy myblog myblog=192.168.51.209:5000/myblog:v2 --record=true
</code></pre>
<p class="indent--2"><strong>查看 deployment 更新历史：</strong><br>
<code>kubectl -n demo rollout history deploy myblog</code><br>
<strong>回滚到具体的 REVISION:</strong><br>
<code> kubectl -n demo rollout undo deploy myblog --to-revision=1</code></p>
<h2 id="为何要控制Pod应该如何调度">为何要控制 Pod 应该如何调度</h2>
<ul>
<li>集群中有些机器的配置高（SSD，更好的内存等），我们希望核心的服务（比如说数据库）运行在上面</li>
<li>某两个服务的网络传输很频繁，我们希望它们最好在同一台机器上</li>
</ul>
<h3 id="NodeSelector">NodeSelector</h3>
<p class="indent--2"><code>label</code> 是 <code>kubernetes</code> 中一个非常重要的概念，用户可以非常灵活的利用 label 来管理集群中的资源，POD 的调度可以根据节点的 label 进行特定的部署。</p>
<p class="indent--2">查看节点的 label：</p>
<p class="indent--2"><code>kubectl get nodes --show-labels</code></p>
<p class="indent--2">为节点打 label：<br>
<code> kubectl label node k8s-master disktype=ssd</code><br>
当 node 被打上了相关标签后，在调度的时候就可以使用这些标签了，只需要在 spec 字段中添加 <code>nodeSelector</code> 字段，里面是我们需要被调度的节点的 label。</p>
<pre><code class="highlight-chroma">...
spec:
  hostNetwork: true	# 声明pod的网络模式为host模式，效果通docker run --net=host
  volumes: 
  - name: mysql-data
    hostPath: 
      path: /opt/mysql/data
  nodeSelector:   # 使用节点选择器将Pod调度到指定label的节点
    component: mysql
  containers:
  - name: mysql
  	image: 192.168.51.209:5000/demo/mysql:5.7
...
</code></pre>
<h3 id="nodeAffinity">nodeAffinity</h3>
<p class="indent--2">节点亲和性 ， 比上面的 <code>nodeSelector</code> 更加灵活，它可以进行一些简单的逻辑组合，不只是简单的相等匹配 。分为两种，软策略和硬策略。</p>
<p class="indent--2">preferredDuringSchedulingIgnoredDuringExecution：软策略，如果你没有满足调度要求的节点的话，Pod 就会忽略这条规则，继续完成调度过程，说白了就是满足条件最好了，没有满足就忽略掉的策略。</p>
<p class="indent--2">requiredDuringSchedulingIgnoredDuringExecution ： 硬策略，如果没有满足条件的节点的话，就不断重试直到满足条件为止，简单说就是你必须满足我的要求，不然我就不会调度 Pod。</p>
<p class="indent--2">要求 Pod 不能运行在 128 和 132 两个节点上，如果有个节点满足 disktype=ssd 的话就优先调度到这个节点上</p>
<pre><code class="highlight-chroma">...
spec:
      containers:
      - name: demo
        image: 172.21.32.6:5000/demo/myblog
        ports:
        - containerPort: 8002
      affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
                nodeSelectorTerms:
                - matchExpressions:
                    - key: kubernetes.io/hostname
                      operator: NotIn
                      values:
                        - 192.168.136.128
                        - 192.168.136.132
            preferredDuringSchedulingIgnoredDuringExecution:
                - weight: 1
                  preference:
                    matchExpressions:
                    - key: disktype
                      operator: In
                      values:
                        - ssd
                        - sas
...
</code></pre>
<p class="indent--2">这里的匹配逻辑是 label 的值在某个列表中，现在 <code>Kubernetes</code> 提供的操作符有下面的几种：</p>
<ul>
<li>In：label 的值在某个列表中</li>
<li>NotIn：label 的值不在某个列表中</li>
<li>Gt：label 的值大于某个值</li>
<li>Lt：label 的值小于某个值</li>
<li>Exists：某个 label 存在</li>
<li>DoesNotExist：某个 label 不存在</li>
</ul>
<p class="indent--2"><em>如果 nodeSelectorTerms 下面有多个选项的话，满足任何一个条件就可以了；如果 matchExpressions 有多个选项的话，则必须同时满足这些条件才能正常调度 Pod</em></p>
<h3 id="污点-Taints-与容忍-tolerations-">污点（Taints）与容忍（tolerations）</h3>
<p class="indent--2">对于 <code>nodeAffinity</code> 无论是硬策略还是软策略方式，都是调度 Pod 到预期节点上，而 <code>Taints</code> 恰好与之相反，如果一个节点标记为 Taints ，除非 Pod 也被标识为可以容忍污点节点，否则该 Taints 节点不会被调度 Pod。</p>
<p class="indent--2">Taints(污点)是 Node 的一个属性，设置了 Taints(污点)后，因为有了污点，所以 Kubernetes 是不会将 Pod 调度到这个 Node 上的。于是 Kubernetes 就给 Pod 设置了个属性 Tolerations(容忍)，只要 Pod 能够容忍 Node 上的污点，那么 Kubernetes 就会忽略 Node 上的污点，就能够(不是必须)把 Pod 调度过去。</p>
<p class="indent--2">比如用户希望把 Master 节点保留给 Kubernetes 系统组件使用，或者把一组具有特殊资源预留给某些 Pod，则污点就很有用了，Pod 不会再被调度到 taint 标记过的节点。taint 标记节点举例如下：</p>
<p class="indent--2">设置污点：</p>
<p class="indent--2">$ kubectl taint node [node_name] key=value:[effect]<br>
其中[effect] 可取值： [ NoSchedule | PreferNoSchedule | NoExecute ]<br>
NoSchedule：一定不能被调度。<br>
PreferNoSchedule：尽量不要调度。<br>
NoExecute：不仅不会调度，还会驱逐 Node 上已有的 Pod。<br>
示例：kubectl taint node k8s-master smoke=true:NoSchedule 去除污点：</p>
<p class="indent--2">去除指定 key 及其 effect：<br>
kubectl taint nodes [node_name] key:[effect]-    #这里的 key 不用指定 value</p>
<p class="indent--2">去除指定 key 所有的 effect:<br>
kubectl taint nodes node_name key-</p>
<p class="indent--2">示例：<br>
kubectl taint node k8s-master smoke=true:NoSchedule<br>
kubectl taint node k8s-master smoke:NoExecute-<br>
kubectl taint node k8s-master smoke-污点演示：</p>
<p class="indent--2"><strong>给 k8s-slave1 打上污点，smoke=true:NoSchedule</strong></p>
<pre><code class="highlight-chroma">$ kubectl taint node k8s-slave1 smoke=true:NoSchedule
$ kubectl taint node k8s-slave2 drunk=true:NoSchedule
</code></pre>
<p class="indent--2"><strong>扩容 myblog 的 Pod，观察新 Pod 的调度情况</strong></p>
<pre><code class="highlight-chroma">$ kuebctl -n demo scale deploy myblog --replicas=3
$ kubectl -n demo get po -w    ## pending
</code></pre>
<p class="indent--2">Pod 容忍污点示例：<code>myblog/deployment/deploy-myblog-taint.yaml</code></p>
<pre><code class="highlight-chroma">[root@k8s-master deployment]# cat deploy-myblog-taint.yaml 
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myblog
  namespace: demo
spec:
  replicas: 1	#指定Pod副本数
  selector:		#指定Pod的选择器
    matchLabels:
      app: myblog
  template:
    metadata:
      labels:	#给Pod打label
        app: myblog
    spec:
      tolerations: #设置容忍性
      - key: "smoke" 
        operator: "Equal"  #如果操作符为Exists，那么value属性可省略,不指定operator，默认为Equal
        value: "true"
        effect: "NoSchedule"
      - key: "drunk" 
        operator: "Equal"  #如果操作符为Exists，那么value属性可省略,不指定operator，默认为Equal
        value: "true"
        effect: "NoSchedule"
      containers:
      - name: myblog
        image: 192.168.51.209:5000/myblog
        imagePullPolicy: IfNotPresent
        env:
        - name: MYSQL_HOST
          valueFrom:
            configMapKeyRef:
              name: myblog
              key: MYSQL_HOST
        - name: MYSQL_PORT
          valueFrom:
            configMapKeyRef:
              name: myblog
              key: MYSQL_PORT
        - name: MYSQL_USER
          valueFrom:
            secretKeyRef:
              name: myblog
              key: MYSQL_USER
        - name: MYSQL_PASSWD
          valueFrom:
            secretKeyRef:
              name: myblog
              key: MYSQL_PASSWD
        ports:
        - containerPort: 8002
        resources:
          requests:
            memory: 100Mi
            cpu: 50m
          limits:
            memory: 500Mi
            cpu: 100m
        livenessProbe:
          httpGet:
            path: /blog/index/
            port: 8002
            scheme: HTTP
          initialDelaySeconds: 10  # 容器启动后第一次执行探测是需要等待多少秒
          periodSeconds: 15 	# 执行探测的频率
          timeoutSeconds: 2		# 探测超时时间
        readinessProbe: 
          httpGet: 
            path: /blog/index/
            port: 8002
            scheme: HTTP
          initialDelaySeconds: 10 
          timeoutSeconds: 2
          periodSeconds: 15
</code></pre>
<p class="indent--2"><code>$ kubectl apply -f deploy-myblog-taint.yaml</code></p>
<pre><code class="highlight-chroma">spec:
      containers:
      - name: demo
        image: 192.168.51.209:5000/demo/myblog
      tolerations:
        - operator: "Exists"
</code></pre>
                <div>
                    <hr>

标题：KUbernets实践之pod控制器<br>
作者：<a href="https://cuijianzhe.github.io" target="_blank">cuijianzhe</a><br>
地址：<a href="https://cuijianzhe.github.io/articles/2020/04/22/1587528230774.html" target="_blank">https://cuijianzhe.github.io/articles/2020/04/22/1587528230774.html</a><br>

<!-- 签名档内可使用 HTML、JavaScript -->
<br>
<pre><p style="font-size:15px"><font color="#008000">
<b>到头来
我们记住的
不是敌人的攻击
而是朋友的沉默
       ---马丁·路德·金</b></p><pre>

                </div>
        </div>
    </div>
    <div class="post__toc">
<ul class="article__toc">
        <li class="toc__h1">
            <a href="#为什么用pod控制器-">为什么用 pod 控制器？</a>
        </li>
        <li class="toc__h1">
            <a href="#Workload--工作负载-">Workload (工作负载)</a>
        </li>
        <li class="toc__h2">
            <a href="#Deployment">Deployment</a>
        </li>
        <li class="toc__h3">
            <a href="#副本保障机制">副本保障机制</a>
        </li>
        <li class="toc__h4">
            <a href="#删除pod-观察pod状态变化">删除 pod，观察 pod 状态变化</a>
        </li>
        <li class="toc__h4">
            <a href="#设置两个副本--或者通过的方式-最好通过修改文件-然后apply的方式-这样yaml文件可以保持同步">设置两个副本, 或者通过 kubectl -n demo edit deploy myblog 的方式，最好通过修改文件，然后 apply 的方式，这样 YAML 文件可以保持同步</a>
        </li>
        <li class="toc__h3">
            <a href="#Pod驱逐策略">Pod 驱逐策略</a>
        </li>
        <li class="toc__h4">
            <a href="#服务更新">服务更新</a>
        </li>
        <li class="toc__h4">
            <a href="#修改测试文件">修改测试文件</a>
        </li>
        <li class="toc__h3">
            <a href="#更新策略">更新策略</a>
        </li>
        <li class="toc__h4">
            <a href="#查看滚动更新事件">查看滚动更新事件</a>
        </li>
        <li class="toc__h3">
            <a href="#服务回滚">服务回滚</a>
        </li>
        <li class="toc__h2">
            <a href="#为何要控制Pod应该如何调度">为何要控制 Pod 应该如何调度</a>
        </li>
        <li class="toc__h3">
            <a href="#NodeSelector">NodeSelector</a>
        </li>
        <li class="toc__h3">
            <a href="#nodeAffinity">nodeAffinity</a>
        </li>
        <li class="toc__h3">
            <a href="#污点-Taints-与容忍-tolerations-">污点（Taints）与容忍（tolerations）</a>
        </li>
</ul>    </div>
    <div class="body--gray post__gray">
        <div class="wrapper comment">
                <div id="gitalk-container" style="padding: 30px 0;"></div>
                <div id="b3logsolocomments"></div>
                <div id="vcomment" style="padding: 30px 0;" data-name="cuijianzhe" data-postId="1587528230774"></div>

            <div class="post__list fn__flex">
                <div class="fn__flex-1">
                    <div id="externalRelevantArticles"></div>
                </div>
                <div class="post__list-mid fn__flex-1">
                    <div id="randomArticles"></div>
                </div>
                <div class="fn__flex-1">
                    <div id="relevantArticles"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="post__fix">
        <div class="wrapper">
            <span class="post__share mobile__none">
                Share
                <span class="tag tag--4" data-type="weibo">WeiBo</span>
                <span class="tag tag--5" data-type="twitter">Twitter</span>
                <span class="tag tag--6" data-type="qqz">QZone</span>
                <span class="post__code tag tag--7"
                      data-type="wechat"
                      data-title="KUbernets实践之pod控制器"
                      data-blogtitle="邯城往事"
                      data-url="https://cuijianzhe.github.io/articles/2020/04/22/1587528230774.html"
                      data-avatar="https://img.hacpai.com/avatar/1551626533851_1579241477243.png?imageView2/1/w/128/h/128/interlace/0/q/100">
                    WeChat
                    <span class="qrcode"></span>
                </span>
            </span>
            <span class="post__arrow">
                    <a href="https://cuijianzhe.github.io/articles/2020/04/18/1587188601330.html" rel="prev"
                       class="vditor-tooltipped__n vditor-tooltipped"
                       pjax-title="用Python实现widows下ping程序"
                       aria-label="旧一篇: 用Python实现widows下ping程序">←</a>

                    <a href="https://cuijianzhe.github.io/articles/2020/04/23/1587624487440.html" rel="next"
                       class="vditor-tooltipped__n vditor-tooltipped"
                       pjax-title="Kubernetes服务访问"
                       aria-label="新一篇: Kubernetes服务访问">→</a>
                <a href="javascript:Util.goTop()" class="vditor-tooltipped__n vditor-tooltipped"
                   aria-label="移动到顶部">↑</a>
                <a href="javascript:Util.goBottom()" class="vditor-tooltipped__n vditor-tooltipped"
                   aria-label="移动到底部">↓</a>
            </span>
        </div>
    </div>
    
</main>
<footer class="footer">
    <div class="ft__center">
    <a href="https://ld246.com/member/cuijianzhe"
       aria-label="https://ld246.com/member/cuijianzhe"
       class="vditor-tooltipped__n vditor-tooltipped  user__site"
       target="_blank" rel="noopener nofollow">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path fill="#d23f31" style="fill: var(--color1, #d23f31)" d="M5.787 17.226h17.033l5.954 9.528c0.47 0.752 0.003 1.361-1.042 1.361h-15.141z"></path>
            <path d="M10.74 3.927h17.033c1.045 0 1.512 0.609 1.042 1.361l-5.954 9.528h-19.872l6.379-10.209c0.235-0.376 0.849-0.681 1.372-0.681z"></path>
            <path d="M2.953 17.226h2.839l6.804 10.889h-1.892c-0.523 0-1.137-0.305-1.372-0.681z"></path>
        </svg>
    </a>

        <a href="https://github.com/cuijianzhe"
           aria-label="https://github.com/cuijianzhe"
           class="vditor-tooltipped__n vditor-tooltipped  user__site"
           target="_blank" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M16 0.331c-8.836 0-16 7.163-16 16 0 7.069 4.585 13.067 10.942 15.182 0.8 0.148 1.094-0.347 1.094-0.77 0-0.381-0.015-1.642-0.022-2.979-4.452 0.968-5.391-1.888-5.391-1.888-0.728-1.849-1.776-2.341-1.776-2.341-1.452-0.993 0.11-0.973 0.11-0.973 1.606 0.113 2.452 1.649 2.452 1.649 1.427 2.446 3.743 1.739 4.656 1.33 0.143-1.034 0.558-1.74 1.016-2.14-3.554-0.404-7.29-1.777-7.29-7.907 0-1.747 0.625-3.174 1.649-4.295-0.166-0.403-0.714-2.030 0.155-4.234 0 0 1.344-0.43 4.401 1.64 1.276-0.355 2.645-0.532 4.005-0.539 1.359 0.006 2.729 0.184 4.008 0.539 3.054-2.070 4.395-1.64 4.395-1.64 0.871 2.204 0.323 3.831 0.157 4.234 1.026 1.12 1.647 2.548 1.647 4.295 0 6.145-3.743 7.498-7.306 7.895 0.574 0.497 1.085 1.47 1.085 2.963 0 2.141-0.019 3.864-0.019 4.391 0 0.426 0.288 0.925 1.099 0.768 6.354-2.118 10.933-8.113 10.933-15.18 0-8.837-7.164-16-16-16z"></path>
            </svg>
        </a>

        <a href="https://twitter.com/JianzheC"
           aria-label="https://twitter.com/JianzheC"
           target="_blank"
           class="vditor-tooltipped__n vditor-tooltipped  user__site" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M32.003 6.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path>
            </svg>
        </a>
        <a href="https://weibo.com/3796930704"
           aria-label="https://weibo.com/3796930704"
           target="_blank"
           class="vditor-tooltipped__n vditor-tooltipped  user__site" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M13.444 27.064c-5.3 0.525-9.875-1.875-10.219-5.35-0.344-3.481 3.675-6.719 8.969-7.244 5.3-0.525 9.875 1.875 10.212 5.35 0.35 3.481-3.669 6.725-8.963 7.244zM24.038 15.521c-0.45-0.137-0.762-0.225-0.525-0.819 0.512-1.287 0.563-2.394 0.006-3.188-1.038-1.481-3.881-1.406-7.137-0.037 0 0-1.025 0.444-0.762-0.363 0.5-1.613 0.425-2.956-0.356-3.737-1.769-1.769-6.469 0.069-10.5 4.1-3.013 3.006-4.763 6.212-4.763 8.981 0 5.287 6.787 8.506 13.425 8.506 8.7 0 14.494-5.056 14.494-9.069 0-2.431-2.044-3.806-3.881-4.375z"></path>
                <path d="M29.819 5.833c-2.1-2.331-5.2-3.219-8.063-2.612v0c-0.663 0.144-1.081 0.794-0.938 1.45 0.144 0.662 0.788 1.081 1.45 0.938 2.038-0.431 4.238 0.2 5.731 1.856s1.9 3.913 1.256 5.888v0c-0.206 0.644 0.144 1.331 0.788 1.544 0.644 0.206 1.331-0.144 1.544-0.787v-0.006c0.9-2.762 0.331-5.938-1.769-8.269z"></path>
                <path d="M26.588 8.752c-1.025-1.138-2.538-1.569-3.925-1.269-0.569 0.119-0.931 0.688-0.813 1.256 0.125 0.569 0.688 0.931 1.25 0.806v0c0.681-0.144 1.419 0.069 1.919 0.619 0.5 0.556 0.637 1.313 0.419 1.975v0c-0.175 0.55 0.125 1.15 0.681 1.331 0.556 0.175 1.15-0.125 1.331-0.681 0.438-1.356 0.163-2.906-0.863-4.037z"></path>
                <path d="M13.738 20.771c-0.188 0.319-0.594 0.469-0.912 0.337-0.319-0.125-0.412-0.488-0.231-0.794 0.188-0.306 0.581-0.456 0.894-0.337 0.313 0.113 0.425 0.469 0.25 0.794zM12.044 22.933c-0.512 0.819-1.613 1.175-2.438 0.8-0.813-0.369-1.056-1.319-0.544-2.119 0.506-0.794 1.569-1.15 2.388-0.806 0.831 0.356 1.1 1.3 0.594 2.125zM13.969 17.146c-2.519-0.656-5.369 0.6-6.463 2.819-1.119 2.262-0.037 4.781 2.506 5.606 2.638 0.85 5.75-0.456 6.831-2.894 1.069-2.394-0.262-4.85-2.875-5.531z"></path>
            </svg>
        </a>
        <a href="https://www.zhihu.com/people/wen-yang-24-36"
           aria-label="https://www.zhihu.com/people/wen-yang-24-36"
           target="_blank"
           class="vditor-tooltipped__n vditor-tooltipped  user__site" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M32 26.67c0 2.931-2.382 5.33-5.33 5.33h-21.339c-2.948 0-5.33-2.382-5.33-5.33v-21.339c0-2.948 2.382-5.33 5.33-5.33h21.339c2.948 0 5.33 2.382 5.33 5.33v21.339zM12.358 17.191h4.713c0-1.114-0.531-1.748-0.531-1.748h-4.079c0.103-2.005 0.189-4.576 0.223-5.536h3.874s-0.017-1.645-0.463-1.645h-6.822s0.411-2.142 0.96-3.085c0 0-2.040-0.12-2.742 2.605-0.686 2.725-1.731 4.354-1.851 4.662s0.6 0.137 0.891 0c0.309-0.137 1.663-0.617 2.057-2.537h2.108c0.034 1.2 0.12 4.885 0.086 5.536h-4.336c-0.6 0.446-0.823 1.748-0.823 1.748h4.971c-0.206 1.371-0.566 3.137-1.080 4.062-0.806 1.491-1.234 2.828-4.131 5.176 0 0-0.48 0.36 0.994 0.223 1.474-0.12 2.845-0.514 3.839-2.434 0.514-0.994 1.011-2.28 1.423-3.565l4.079 4.713s0.548-1.268 0.137-2.657l-3.034-3.394-1.028 0.754c0.291-0.994 0.497-1.988 0.548-2.845 0.017 0.017 0.017 0 0.017-0.034zM18.048 7.936v16.3h1.714l0.703 1.954 2.965-1.954h3.754v-16.3h-9.136zM25.401 22.487h-1.937l-2.434 1.611-0.566-1.611h-0.6v-12.735h5.553v12.735h-0.017z"></path>
            </svg>
        </a>
        <a href="tencent://message/?uin=598941324"
           aria-label="598941324"
           target="_blank"
           class="vditor-tooltipped__n vditor-tooltipped  user__site" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M4.821 14.393c-0.125-0.304-0.143-0.607-0.143-0.929 0-0.5 0.321-1.304 0.625-1.679-0.018-0.464 0.179-1.411 0.536-1.714 0-3.304 2.554-7.464 5.536-8.893 1.839-0.875 3.768-1.179 5.786-1.179 1.571 0 3.286 0.375 4.75 0.982 4.196 1.768 5.143 5.054 6.036 9.25l0.018 0.089c0.518 0.786 0.982 1.714 0.982 2.679 0 0.482-0.321 0.964-0.321 1.393 0 0.036 0.107 0.179 0.125 0.214 1.536 2.268 2.929 4.732 2.929 7.554 0 0.625-0.339 2.804-1.339 2.804-0.696 0-1.464-1.696-1.714-2.161-0.018-0.018-0.036-0.018-0.054-0.018l-0.089 0.071c-0.571 1.482-1.196 2.875-2.357 3.982 1.018 0.982 2.661 0.893 2.964 2.589-0.089 0.196-0.054 0.411-0.196 0.607-1.018 1.536-3.75 1.732-5.393 1.732-2.179 0-3.946-0.571-6-1.179-0.429-0.125-1.071-0.054-1.536-0.107-1.089 1.196-3.75 1.518-5.286 1.518-1.357 0-6.607-0.089-6.607-2.411 0-1 0.214-1.286 0.911-1.929 0.554-0.107 0.964-0.411 1.607-0.446 0.089 0 0.161-0.018 0.25-0.036 0.018-0.018 0.036-0.018 0.036-0.071l-0.036-0.054c-1.232-0.286-2.964-3.393-3.232-4.679l-0.089-0.054c-0.125 0-0.179 0.268-0.214 0.357-0.393 0.911-1.321 1.893-2.357 2h-0.018c-0.143 0-0.089-0.143-0.196-0.179-0.25-0.589-0.411-1.125-0.411-1.786 0-3.571 1.714-6.214 4.5-8.321z"></path>
            </svg>
        </a>
        <a href="javascript:void(0)"
           class="vditor-tooltipped__n vditor-tooltipped  user__site" aria-label="cjz5989">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M9.062 9.203c0-0.859-0.562-1.422-1.422-1.422-0.844 0-1.703 0.562-1.703 1.422 0 0.844 0.859 1.406 1.703 1.406 0.859 0 1.422-0.562 1.422-1.406zM20.672 17.125c0-0.562-0.562-1.125-1.422-1.125-0.562 0-1.125 0.562-1.125 1.125 0 0.578 0.562 1.141 1.125 1.141 0.859 0 1.422-0.562 1.422-1.141zM16.984 9.203c0-0.859-0.562-1.422-1.406-1.422-0.859 0-1.703 0.562-1.703 1.422 0 0.844 0.844 1.406 1.703 1.406 0.844 0 1.406-0.562 1.406-1.406zM26.906 17.125c0-0.562-0.578-1.125-1.422-1.125-0.562 0-1.125 0.562-1.125 1.125 0 0.578 0.562 1.141 1.125 1.141 0.844 0 1.422-0.562 1.422-1.141zM22.75 10.922c-0.359-0.047-0.719-0.063-1.094-0.063-5.375 0-9.625 4.016-9.625 8.953 0 0.828 0.125 1.625 0.359 2.375-0.359 0.031-0.703 0.047-1.063 0.047-1.422 0-2.547-0.281-3.969-0.562l-3.953 1.984 1.125-3.406c-2.828-1.984-4.531-4.547-4.531-7.656 0-5.391 5.094-9.625 11.328-9.625 5.563 0 10.453 3.391 11.422 7.953zM32 19.687c0 2.547-1.688 4.813-3.969 6.516l0.859 2.828-3.109-1.703c-1.141 0.281-2.281 0.578-3.406 0.578-5.391 0-9.625-3.688-9.625-8.219s4.234-8.219 9.625-8.219c5.094 0 9.625 3.688 9.625 8.219z"></path>
            </svg>
        </a>
    </div>
    <nav class="footer__nav mobile__none">
            <a class="ft__link" href="/my-github-repos" target="_self" rel="section">
                我的开源
            </a>
            <a class="ft__link" href="http://times.cjzshilong.cn/time/time.html" target="_blank" rel="section">
                服务器倒计时
            </a>
        <a class="ft__link" rel="alternate" href="https://cuijianzhe.github.io/rss.xml" rel="section">RSS</a>
    </nav>
    <div class="footer__border mobile__none"></div>
    <div class="wrapper fn__flex">
        <div class="fn__flex-1 mobile__none">
            <div class="ft__fade">cuijianzhe -                >>>  展颜笑夙愿，一笑泯恩仇 <<<</div>
            <br>
                <!-- MetingJS音乐播放器 不能放到 head 导致系统功能加载异常-->
<link rel="stylesheet" href="//cdn.staticfile.org/aplayer/1.10.1/APlayer.min.css">
<script src="//cdn.staticfile.org/aplayer/1.10.1/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<meting-js server="netease" type="playlist" id="728729850"  autoplay="false" fixed ="true" order = "random"</meting-js>

<h1><p style="font-size:10px"><font color="#2F4F4F">红笺小字，说尽平生意。<br/>鸿雁在云鱼在水，惆怅此情难寄。<br/>             ——晏殊· 《清平乐》</font> </p></h1>

        </div>

            <div class="footer__mid fn__flex-1 mobile__none">
                <div class="ft__fade">分类</div>
                <br>
                    <a href="https://cuijianzhe.github.io/category/python"
                       aria-label="36 文章"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        人生苦短,我用Python</a> &nbsp; &nbsp;
                    <a href="https://cuijianzhe.github.io/category/java"
                       aria-label="0 文章"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        Java是世界上最好的语言</a> &nbsp; &nbsp;
                    <a href="https://cuijianzhe.github.io/category/linux"
                       aria-label="52 文章"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        Linux系列</a> &nbsp; &nbsp;
                    <a href="https://cuijianzhe.github.io/category/network"
                       aria-label="4 文章"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        Network系列</a> &nbsp; &nbsp;
                    <a href="https://cuijianzhe.github.io/category/young"
                       aria-label="8 文章"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        江湖就是人情世故</a> &nbsp; &nbsp;
            </div>

        <div class="fn__flex-1 footer__copyright">
            <a class="ft__link" href="https://cuijianzhe.github.io/archives.html">
                114
                文章
            </a>
           <br>
            <span data-uvstaturl="https://cuijianzhe.github.io">92571</span> <span class="ft-gray">浏览</span>
 <br>
            &copy; 2021
            <a class="ft__link" href="https://cuijianzhe.github.io">邯城往事</a>
            <img style="width: 20px; height: 20px;" src="https://img.hacpai.com/file/2019/10/jinghuibeian-30e807bb.png" alt="备案标识" /><a href="http://beian.miit.gov.cn" target="_blank" rel="nofollow noopener">冀ICP备19005901号-1</a> 

<!--切换标签实现网页标题变化-->
<script type="text/javascript">
    /*自动刷新页面，避免无法访问*/
    var OriginTitile = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function () {
        if (document.hidden) {
            document.title = '一杯茶，一包烟，混过一天是一天';
            clearTimeout(titleTime);
        } else {
            document.title = '哈哈，我是大佬ヾ(ﾟ∀ﾟゞ)';
            titleTime = setTimeout(function () {
                document.title = OriginTitile;
            }, 3000);
        }
    });
</script>
<!--切换标签实现网页标题变化 结束-->


<script>
  document.addEventListener("DOMContentLoaded", function (event) {
    if (Label.articleId) {
      const gitalk = new Gitalk({
        clientID: '4e3eaf0bc17bd516ba5b',
        clientSecret: '644d549c51d9fece70856677fc92411e6b6ced0e',
        repo: 'solo-blog',
        owner: 'cuijianzhe',
        admin: ['cuijianzhe'],
        id: Label.articleId,
        distractionFreeMode: false
      })

      gitalk.render('gitalk-container')
    }
  })
</script>

        </div>
    </div>
</footer>
<script>
  var Label = {
    speech: true,
    servePath: "https://cuijianzhe.github.io",
    staticServePath: "https://cdn.jsdelivr.net/gh/88250/solo@3e5209c/src/main/resources",
    luteAvailable: true,
    hljsStyle: 'monokai',
    langLabel: "zh_CN",
    version: "4.3.1",
    staticSite: true,
    showCodeBlockLn: false,
    articleId: "1587528230774",
  }
</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/88250/solo@3e5209c/src/main/resources/skins/Pinghsu/js/headroom.min.js"></script>
<script type="text/javascript"
        src="https://cdn.jsdelivr.net/gh/88250/solo@3e5209c/src/main/resources/skins/Pinghsu/js/common.min.js?1617303621572"
        charset="utf-8"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.10/index.css"/>
<script async src="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.10/index.js"></script>
<div class="solo-kanbanniang">
    <div class="solo-kanbanniang__tip"></div>
    <canvas id="soloKanbanniang" width="280" height="250"></canvas>
    <div class="solo-kanbanniang__tool">
        <svg id="soloKanbanniangHome" viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M32 18.967l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18.516v12h-8v-8h-8v8h-8v-12l12-9z"></path>
        </svg>
        <svg id="soloKanbanniangRSS" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M320.364 768q0 45.728-32 77.728t-77.728 32-77.728-32-32-77.728 32-77.728 77.728-32 77.728 32 32 77.728zM612.94 838.272q1.152 16-9.728 27.424-10.272 12-26.848 12h-77.152q-14.272 0-24.576-9.44t-11.424-23.712q-12.576-130.848-105.44-223.712t-223.712-105.44q-14.272-1.152-23.712-11.424t-9.44-24.576V402.24q0-16.576 12-26.848 9.728-9.728 24.576-9.728h2.848q91.424 7.424 174.848 46.016t148 103.712q65.152 64.576 103.712 148t46.016 174.848z m292.576 1.152q1.152 15.424-10.272 26.848-10.272 11.424-26.272 11.424h-81.728q-14.848 0-25.44-10.016t-11.136-24.288q-6.848-122.848-57.728-233.44t-132.288-192-192-132.288-233.44-58.272q-14.272-0.576-24.288-11.136t-10.016-24.864V109.664q0-16 11.424-26.272 10.272-10.272 25.152-10.272h1.728q149.728 7.424 286.56 68.576t243.136 168q106.848 106.272 168 243.136t68.576 286.56z"></path>
        </svg>
        <svg id="soloKanbanniangChat" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M802.42709 96.163153H219.476155c-84.48109 0-154.896836 71.746044-154.896836 157.840888v393.119449c0 86.072331 70.415746 157.819398 154.896836 157.819399h214.038818V925.470963s22.526039 40.168862 64.767096 5.734608c30.965246-25.819039 126.721123-91.828428 171.775248-123.385145h132.369773c84.502579 0 154.896836-83.21526 154.896836-157.839865V251.125481c0-86.094844-70.394257-154.962328-154.896836-154.962328zM301.144176 518.002714c-39.427988 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044 39.426965 0 70.393233 31.577183 70.393234 71.746044 0 40.169885-30.966269 71.746044-70.393234 71.746044z m208.411657 0c-39.450501 0-70.415746-31.576159-70.415746-71.746044 0-40.168862 30.965246-71.746044 70.415746-71.746044 39.405475 0 70.394257 31.577183 70.394257 71.746044 0 40.169885-30.988782 71.746044-70.394257 71.746044z m211.203236 0c-39.426965 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044s70.415746 31.577183 70.415746 71.746044c-0.001023 40.169885-30.988782 71.746044-70.415746 71.746044z"></path>
        </svg>
        <svg id="soloKanbanniangChange" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M936.672 193.216l-226.88-64c-8.704-2.528-18.112-1.12-25.824 3.776-7.68 4.864-12.896 12.736-14.432 21.728C655.712 236.928 595.328 288 512 288c-71.424 0-142.464-103.296-163.776-143.104-7.136-13.28-22.528-19.84-37.024-15.68l-224 64C73.472 197.152 64 209.728 64 224v256a31.93 31.93 0 0 0 11.712 24.736c7.392 6.08 17.152 8.512 26.56 6.624L224 487.04V832c0 52.928 43.072 96 96 96h384c52.928 0 96-43.072 96-96V519.04l121.728 24.352c9.44 1.92 19.2-0.544 26.56-6.624C955.68 530.656 960 521.6 960 512V224c0-14.336-9.536-26.912-23.328-30.784zM672 800H352c-17.664 0-32-14.304-32-32s14.336-32 32-32h320c17.696 0 32 14.304 32 32s-14.304 32-32 32z"></path>
        </svg>
        <svg id="soloKanbanniangPhoto" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M898.048 258.048q23.552-1.024 46.592 9.216t40.96 27.136 28.672 39.424 10.752 46.08l0 390.144q0 24.576-10.752 47.104t-28.672 40.448-40.96 28.16-47.616 10.24l-697.344 0q-24.576 0-48.64-10.24t-42.496-27.648-29.696-40.448-11.264-48.64l0-381.952q0-22.528 10.752-45.568t28.672-41.472 39.936-30.208 44.544-11.776l63.488 0 13.312-83.968q3.072-20.48 18.432-32.768t34.816-12.288l456.704 0q19.456 0 34.304 10.752t16.896 34.304l14.336 83.968 54.272 0zM548.864 712.704q40.96 0 77.824-15.872t63.488-42.496 42.496-62.976 15.872-77.312-15.872-77.312-42.496-62.976-63.488-42.496-77.824-15.872-77.312 15.872-63.488 42.496-43.008 62.976-15.872 77.312 15.872 77.312 43.008 62.976 63.488 42.496 77.312 15.872z"></path>
        </svg>
        <svg id="soloKanbanniangGithub" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M1024 524.8c0 114.346667-32.554667 217.216-97.706667 308.565333-65.066667 91.306667-149.162667 154.538667-252.288 189.610667-11.989333 2.304-20.778667 0.682667-26.325333-4.778667a27.605333 27.605333 0 0 1-8.362667-20.48v-144.213333c0-44.16-11.52-76.501333-34.645333-97.024 25.344-2.730667 48.085333-6.826667 68.309333-12.288a268.629333 268.629333 0 0 0 62.72-26.666667 187.434667 187.434667 0 0 0 53.973334-45.44c14.421333-18.005333 26.197333-41.898667 35.328-71.765333 9.088-29.824 13.653333-64.128 13.653333-102.826667 0-55.125333-17.536-102.058667-52.650667-140.8 16.426667-41.429333 14.677333-87.893333-5.333333-139.392-12.458667-4.096-30.464-1.578667-54.016 7.509334a355.328 355.328 0 0 0-61.312 30.08L640 271.274667a462.336 462.336 0 0 0-128-17.749334c-43.989333 0-86.656 5.930667-128 17.749334a589.824 589.824 0 0 0-28.330667-18.432c-11.776-7.253333-30.336-16.042667-55.68-26.325334-25.344-10.24-44.416-13.312-57.301333-9.216-19.584 51.498667-21.12 97.962667-4.693333 139.434667-35.114667 38.698667-52.650667 85.632-52.650667 140.757333 0 38.698667 4.565333 72.874667 13.653333 102.485334 9.130667 29.610667 20.778667 53.546667 34.986667 71.765333 14.250667 18.218667 32.128 33.493333 53.674667 45.781333 21.546667 12.288 42.453333 21.205333 62.677333 26.666667 20.224 5.461333 43.008 9.557333 68.309333 12.288-17.749333 16.384-28.629333 39.850667-32.64 70.4a130.005333 130.005333 0 0 1-29.994666 10.24c-10.666667 2.261333-23.338667 3.413333-37.973334 3.413333-14.72 0-29.269333-4.906667-43.690666-14.677333-14.464-9.813333-26.794667-24.064-36.992-42.709333a109.226667 109.226667 0 0 0-32.341334-35.541334c-13.141333-9.130667-24.106667-14.592-33.024-16.426666l-13.312-2.048c-9.344 0-15.786667 1.024-19.328 3.072-3.584 2.090667-4.693333 4.693333-3.328 7.893333 1.28 3.157333 3.328 6.4 5.973334 9.557333 2.688 3.2 5.546667 5.930667 8.661333 8.192l4.693333 3.413334c9.770667 4.565333 19.413333 13.226667 29.013334 25.984 9.514667 12.757333 16.512 24.362667 20.992 34.858666l6.656 15.701334c5.76 17.322667 15.530667 31.317333 29.312 42.026666 13.781333 10.666667 28.672 17.536 44.672 20.48 16 2.986667 31.445333 4.565333 46.336 4.821334 14.890667 0.213333 27.221333-0.597333 36.992-2.389334l15.36-2.730666c0 17.28 0.085333 37.546667 0.298666 60.8l0.341334 36.906666a27.050667 27.050667 0 0 1-8.661334 20.48c-5.76 5.461333-14.677333 7.082667-26.666666 4.778667-103.125333-35.072-187.221333-98.261333-252.330667-189.610667C32.554667 742.058667 0 639.146667 0 524.8c0-95.232 22.869333-183.04 68.693333-263.466667A516.266667 516.266667 0 0 1 254.976 70.4C333.44 23.466667 419.114667 0 512 0c92.885333 0 178.56 23.466667 256.981333 70.4a516.266667 516.266667 0 0 1 186.368 190.976C1001.130667 341.802667 1024 429.653333 1024 524.842667z"></path>
        </svg>
        <svg id="soloKanbanniangClose" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M517.572566143763 1018.6748601482986C238.26554897656422 1018.6748601482986 11.897910175114305 792.2714997690043 11.897910175114305 513.0002041796496c0-279.3070171671984 226.36763880144977-505.71037754649296 505.6746559686481-505.71037754649296 279.2712955893538 0 505.6746559686481 226.40336037929444 505.6746559686481 505.71037754649296C1023.2472221124112 792.2714997690043 796.8795833109612 1018.6748601482986 517.572566143763 1018.6748601482986zM754.7281214542927 339.25044954334646c13.752807470184345-13.752807470184345 9.680547595895998-40.186775075214015-9.073280772537204-58.94060344364717l-2.143294670678079-2.1075730928334457c-18.7538283684332-18.7538283684332-45.15207439561819-22.861809820566194-58.90488186580257-9.073280772537204l-168.21291007038468 168.24863164822932-180.42968969324974-180.46541127109438c-13.967136937252159-13.967136937252159-40.72259874288353-9.823433907274534-59.72647815622916 9.216167083915742l-2.143294670678079 2.143294670678079c-19.039600991190277 19.003879413345654-23.111860865478626 45.75934121897699-9.180445506071107 59.655035000539876l180.42968969324974 180.46541127109438-176.07165719620428 176.03593561835962c-13.788529048028984 13.824250625873615-9.716269173740633 40.151053497369375 9.073280772537204 58.94060344364717l2.1075730928334457 2.1075730928334457c18.7538283684332 18.7538283684332 45.15207439561819 22.897531398410823 58.90488186580257 9.073280772537204l176.10737877404887-176.10737877404887 170.39192631890742 170.42764789675192c13.967136937252159 13.931415359407513 40.686877165038865 9.85915548511917 59.690756578384516-9.180445506071107l2.1790162485227142-2.1790162485227142c19.039600991190277-18.968157835501014 23.147582443323273-45.72361964113239 9.180445506071107-59.690756578384516l-170.39192631890742-170.42764789675192L754.7281214542927 339.25044954334646z"></path>
        </svg>
    </div>
</div>



<script type="text/javascript">
    Util.addScript('https://cdn.jsdelivr.net/gh/88250/solo@3e5209c/src/main/resources/js/page.min.js?1617303621572', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论不能为空",
        "oId": "1587528230774",
        "blogHost": "https://cuijianzhe.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "5";
    page.loadRandomArticles('<h3>RECOMMEND POSTS</h3>');
    page.loadExternalRelevantArticles("Linux,kubernets",
    '<h3>HACPAI POSTS</h3>');
    page.loadRelevantArticles('1587528230774', '<h3>RELEVANT POSTS</h3>');
Skin.initArticle()
    });
</script>

</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 84ms, 2021/04/02 14:38:24 -->